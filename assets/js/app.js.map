{"version":3,"sources":["general/general.js","async/async.js","attachment/attachment.bootstrap.js","attachment/attachment.js","blog/blog.bootstrap.js","blog/blog.js","admin/admin.js","browser/browser.js","content/content.bootstrap.js","content/content.js","content/content.medium.js","crossbrowser/crossbrowser.js","config/config.js","download/download.js","event/event.js","fallback/fallback.js","focus/focus.js","app.js","history/history.js","importexport/importexport.bootstrap.js","importexport/importexport.js","gallery/gallery.js","info/info.js","multisite/multisite.js","routes/routes.bootstrap.js","routes/routes.js","session/session.js","sidebar/sidebar.js","signin/signin.bootstrap.js","signin/signin.js","sails/sails.js","sortable/sortable.js","subnavigation/subnavigation.js","theme/theme.js","toolbar/toolbar.js","uploader/uploader.bootstrap.js","user/user.js","utilities/utilities.js","validation/validation.bootstrap.js","validation/validation.js","i18n.js","log.js","routes.js","translations.js","AdminController.js","AppController.js","ApplicationController.js","BrowserController.js","CmsController.js","FooterController.js","GalleryContentController.js","GalleryFullscreenController.js","GallerySlideController.js","HomeContentController.js","ImprintController.js","LayoutController.js","LinksController.js","MembersController.js","SigninController.js","TimelineController.js","ToolbarController.js","UserController.js","UsersController.js","match.js","ngThumb.js","resize.js","webodf.js"],"names":["angular","module","service","async","objectMap","obj","func","cb","i","arr","keys","Object","length","wrapper","this","map","err","data","res","directive","$compile","$window","mediumOptions","AttachmentService","restrict","templateUrl","scope","attachment","attachmentIndex","parent","path","authenticated","destroy","centerImage","link","$scope","$element","$attrs","console","log","controller","open","moment","$sailsSocket","$async","$log","url","target","destroyLocally","blogPosts","postIndex","attachments","splice","destroyExternally","put","blogPostID","id","attachmentUploadedAs","uploadedAs","success","status","headers","config","debug","error","post","indexOf","focus","BlogService","$modal","FileUploader","editModal","typeModal","page","openTypeChooserModal","blogPost","$promise","then","show","setModals","fileOptions","pageString","onFileCompleteCallback","isString","title","ok","accept","hide","abort","isUndefined","thumbnail","width","rescrop","cropwidth","cropheight","uploadOptions","removeAfterUpload","options","JSON","stringify","uploader","isFunction","onComplete","onCompleteItem","fileItem","response","isArray","files","push","onProgressItem","progress","upload","chooseType","$on","modalEvent","validate","callback","getModals","getEditModal","getTypeModal","edit","createEdit","create","update","$filter","types","deleteAttachment","fix","type","removeFromClient","index","users","sort","reverse","transform","append","moreBlogPosts","apply","prepent","unshift","createdAt","content","author","object","name","toLowerCase","replace","fixEach","objects","refresh","saveOne","errors","isDefined","saveBlocks","blogPostsArray","save","find","limit","skip","resp","count","subscribe","msg","verb","$rootScope","pop","findEvent","blogPostBlock","resolve","remove","destroyAttachment","$state","download","toogleHtml","add","addDropdown","addDropdownActions","adminSettingDropdown","allowActions","goToState","go","text","click","force","ImportExportBootstrapService","UtilityService","ContentService","SortableService","modals","host","setHost","newHost","setupImportModal","onImportFinsih","onCompleteFile","concat","setImports","identifierKey","descriptionKey","onImportStart","imports","next","item","importOptions","doImport","updateOrCreateByHostByTitleAndPage","results","onAbort","showImportModal","$download","JLSailsService","showHtml","getShowHtml","setEditModal","changeName","$watch","newValue","oldValue","generateName","event","validateContent","toogleShowHtml","contents","beautifyEach","beautify","html_beautify","getByName","findKeyValue","swap","index_1","index_2","moveForward","moveBackward","isNumber","position","warn","saveParallel","logger","parallel","applyResults","extend","findOne","query","Array","findAll","findByHost","method","resultIsArray","exportByHost","findAllWithImage","get","images","resolveOne","resolveAll","resolveAllWithImage","value","buttonLabels","toolbar","buttons","Imager","button","document","createElement","className","innerText","innerHTML","onclick","onClick","bind","prototype","classApplier","toggleSelection","getButton","checkState","node","tagName","classList","ContentMediumService","html","mediumBindOptions","extensions","image","SubnavigationService","HistoryService","navs","afterRefresh","afterSave","afterRemove","afterEdit","afterAdd","subnavigation","afterSaveNav","afterRemoveNav","afterEditNav","afterAddNav","goTo","goToHashPosition","current","result","toggleHtml","Date","now","getTime","vendors","window","requestAnimationFrame","vp","cancelAnimationFrame","test","navigator","userAgent","lastTime","nextTime","Math","max","setTimeout","clearTimeout","info","eventBlockName","split","events","unknown","before","after","to","from","isAfter","invertOrder","merge","allEvents","minutes","person","place","eventBlocks","saveAllInBlock","eventBlocksArray","eventBlock","EventService","$location","protocol","charAt","factory","$timeout","element","getElementById","elem","attr","on","eventFocus","eventFocusId","off","jumplink","$anchorScroll","history","state","params","all","step","prev","previous","abs","back","hash","yOffset","autoScroll","run","toParams","fromParams","uploadModal","onCompleteItemCallback","alias","onCompleteAll","getUploadModal","identifier","description","Fullscreen","fullscreenImage","dropdown","getDropdown","prepairUploadModal","imageBlocks","contentBlocks","selects","getSelects","selectedContentBlock","setUploadModal","onCompleteCallback","filters","fn","slice","lastIndexOf","forEach","file","selected","currentImages","last_position","original","blockNames","blockName","array","label","contentname","saveAllBlocks","saveAll","filename","addBlock","aspect","height","scale","aspectRatio","win","paddingTopBottom","paddingLeftRight","isFullScreen","getWindowDimensions","padding-right","padding-left","padding-top","padding-bottom","warns","infoUser","infoAdmin","restart","resolveNames","resolveHosts","RoutesService","updateOrCreateByHostByObjectNameAndNavbar","provider","jlRoutesProvider","$stateProvider","$urlRouterProvider","$locationProvider","html5Mode","otherwise","when","url1","url2","setLayouts","layouts","stateName","setRoutes","routes","routeOptions","main","customstate","eval","views","view","objectName","isObject","alternativeUrls","a","$get","jlRoutes","filter","active","match","fallback","route","updateOrCreate","updateOrCreateByHost","updateOrCreateEach","updateOrCreateEachByHost","generateObjectnameFromStatename","statename","objectname","k","capitalizeFirstLetter","lowercaseFirstLetter","generateObjectnameFromUrl","saveEachByHost","$q","user","isAuthenticated","defer","needToBeAuthenticated","deferred","reject","promise","bloggerOrBetter","developerOrBetter","siteadminOrBetter","superadmin","employee","employeeOrBetter","needToBeEmployeeOrBetter","needToBeSiteadminOrBetter","getAllPolicies","getUser","transclude","SigninService","siginWithModal","goBackAfterSignin","extendRoles","signinModal","aborted","email","password","signin","SessionService","resetPosition","object_1","object_2","position_tmp","move","old_index","new_index","undefined","unique","uniqueKey","new_object","new_position","uniqueIndex","okay","moveObjectToAnotherArray","index_from","array_from","array_to","replaceData","errorParamsNotSet","index_to","dropMove","dropObjectIndex","dragObject","moveFunction","dragObjectIndex","dropObject","resizeOnImagesLoaded","imagesLoaded","triggerHandler","Number","nav","removeByTarget","fixed","addNav","moveForwardNav","moveBackwardNav","editNavs","removeNav","onDragOnComplete","evt","onDragOnNavComplete","onDropOnComplete","dropnavindex","dragnav","onDropOnNavComplete","onDropOnAreaComplete","isSubscribed","themes","shorttitle","fluid","fullscreenIsSupported","isSupported","isFullscreen","isFullscreenEnabled","toggleFullscreen","isEnabled","cancel","labelFiles","role","key","getKeys","string","toUpperCase","jlValidationProvider","$validationProvider","setup","setErrorHTML","setSuccessHTML","validCallback","$","parents","removeClass","addClass","invalidCallback","getLocale","changeLocale","jlValidationBootstrap","defaultMsg","minlength","getDefaultMsg","maxlength","required","number","lang","setDefaultMsg","jlValidation","cms","amMoment","$logProvider","debugEnabled","environment","abstract","layoutHome","news","template","footer","layoutMembers","members","layoutEvents","ConfigService","layoutGallery","contents_images","layoutApplication","application","layoutLinks","links","layoutImprint","imprint","themeSettings","$stateParams","CmsService","layoutSignin","layoutBrowser","toState","fromState","ThemeService","available","toaster","body","timeout","bodyOutputType","clickHandler","generalSubscribes","adminSubscribes","subject","mainStyle","toasterPositionClass","loadclass","bodyclass","onresize","$apply","windowHeight","windowWidth","logout","date","member","datum","vorname","geburtstag","geburtsort","telefon","beruf","strasse","plz","ort","bank","iban","bic","minYearsOld","minBirthdayDate","subtract","maxYearsOld","maxBirthdayDate","cc","String","attachmentFilename","webodf","odtFilename","odtPath","fd","extension","pdfPath","htmlPath","onWebODFReady","ready","GalleryService","imageOptions","paths","gallery","removeContent","removeImage","addImage","addContent","successes","imageBock","moveForwardContent","moveBackwardContent","editImage","editContent","newContent","saveImage","stopPropagation","goToImage","onDragOnImageComplete","onDropOnImageComplete","dropimageindex","dragimage","content_from","content_to","setSlide","slideIndex","newVal","oldVal","sendMail","nvc","lat","lng","zoom","markers","main_marker","draggable","message","noHide","editMemberModal","thumb","newMember","job","site","saveMember","newPosition","oldPosition","openAttachment","sussces","savedEvent","savedEvents","navbar","UserService","require","attrs","ctrl","modelValue","$modelValue","$$invalidModelValue","$pristine","currentValue","$setValidity","helper","support","FileReader","CanvasRenderingContext2D","isFile","File","isImage","attributes","onLoadFile","img","Image","onload","onLoadImage","src","canvas","getContext","drawImage","$eval","ngThumb","reader","readAsDataURL","setStyle","style","createBlob","FileList","Blob","blob","buffer","downloadBlobAs","saveAs","uploadBlobAs","folder","formData","req","resInfo","FormData","XMLHttpRequest","send","parse","responseText","downloadAs","odfContainer","createByteArray","getDocumentType","uploadAs","getUserFieldElements","odfParentNodeElement","textns","userFieldsGet","getElementsByTagNameNS","userFieldsDecl","childNodes","decl","updateUserFieldGetElement","userFieldGetNodeElements","founds","currentName","getAttribute","textContent","updateUserFieldDeclElement","userFieldDeclNodeElements","notFound","setAttribute","updateUserFieldElement","userFieldNodeElements","curValue","human","initializeWidth","odfCanvas","paddingLeft","paddingRight","clientWidth","innerWidth","parseInt","getComputedStyle","getPropertyValue","fitSmart","updateDocument","odfContentNodeElement","subkey","invoice","nid","floor","random","odf","OdfCanvas","load","addListener","refreshSize","getContentElement"],"mappings":"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","file":"app.js","sourcesContent":["if (typeof jumplink === 'undefined') {\n  var jumplink = {};\n}","angular.module('ngAsync', [])\n.service('$async', function () {\n  // https://github.com/caolan/async/issues/374#issuecomment-27498818\n  async.objectMap = function ( obj, func, cb ) {\n    var i, arr = [], keys = Object.keys( obj );\n    for ( i = 0; i < keys.length; i += 1 ) {\n      var wrapper = {};\n      wrapper[keys[i]] = obj[keys[i]];\n      arr[i] = wrapper;\n    }\n    this.map( arr, func, function( err, data ) {\n      if ( err ) { return cb( err ); }\n      var res = {};\n      for ( i = 0; i < data.length; i += 1 ) {\n          res[keys[i]] = data[i];\n      }\n      return cb( err, res );\n    });\n  };\n  return async;\n});","angular.module('jumplink.cms.bootstrap.attachment', [\n  'jumplink.cms.attachment',\n])\n.directive('jlAttachmentBootstrap', function ($compile, $window, mediumOptions, AttachmentService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/attachment.bootstrap.jade',\n    scope: {\n      attachment: \"=\",\n      attachmentIndex: \"=\",\n      parent: \"=\",\n      path: \"=\",\n      authenticated: \"=\",\n      destroy: \"=\",\n      centerImage: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      console.log(\"[jlAttachmentBootstrap.link]\", $scope);\n    },\n    controller: function ($scope, AttachmentService) {\n      $scope.open = AttachmentService.open;\n    }\n  };\n});","angular.module('jumplink.cms.attachment', [\n  'sails.io',\n])\n\n.service('AttachmentService', function (moment, $sailsSocket, $async, $log, $window) {\n\n  var open = function (url, target) {\n    $window.open(url, target);\n  };\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var destroyLocally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    if(blogPosts[postIndex].attachments.length > 0) {\n      blogPosts[postIndex].attachments.splice(attachmentIndex, 1);\n    }\n    return cb(null, blogPosts, postIndex, attachmentIndex);\n  };\n\n  /**\n   * delete attachment extern / server\n   */\n  var destroyExternally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    $sailsSocket.put('/blog/destroyAttachment', {blogPostID: blogPosts[postIndex].id, attachmentUploadedAs: blogPosts[postIndex].attachments[attachmentIndex].uploadedAs})\n    .success(function (data, status, headers, config) {\n      $log.debug(null, data, status, headers, config);\n      cb();\n    })\n    .error(function (data, status, headers, config) {\n      $log.error(data, status, headers, config);\n      cb(\"error\", data, status, headers, config);\n    });\n  };\n\n  var destroy = function (blogPosts, post, attachmentIndex, cb) {\n    var postIndex = blogPosts.indexOf(post);\n    $log.debug(\"[BlogService.destroy]\", blogPosts[postIndex], attachmentIndex);\n    return destroyExternally(blogPosts, postIndex, attachmentIndex, function (err, data, status, headers, config) {\n      if(err) {\n        return cb(err, data, status, headers, config);\n      }\n      return destroyLocally(blogPosts, postIndex, attachmentIndex, cb);\n    });\n  };\n\n  return {\n    open: open,\n    destroyLocally: destroyLocally,\n    destroyExternally: destroyExternally,\n    destroy: destroy,\n  };\n});","angular.module('jumplink.cms.bootstrap.blog', [\n  'jumplink.cms.blog',\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'ngFocus',\n])\n\n.service('BlogBootstrapService', function ($log, focus, BlogService, $modal, FileUploader) {\n\n  var editModal = null;\n  var typeModal = null;\n  var page = null;\n\n  var openTypeChooserModal = function(blogPost) {\n    typeModal.$scope.blogPost = blogPost;\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString, onFileCompleteCallback) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n\n    editModal = $modal({title: 'Blogpost bearbeiten', templateUrl: '/views/modern/blog/editmodal.bootstrap.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {\n        path: 'assets/files/blog', // TODO get path from config\n        thumbnail: {\n          width: 300,\n          path: 'assets/files/blog' // TODO get path from config\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'blog/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    if(angular.isFunction(onFileCompleteCallback)) {\n      $scope.uploader.onComplete = onFileCompleteCallback;\n    }\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      $log.debug(\"[BlogBootstrapService.onCompleteItem] fileItem\", fileItem, \"response\", response);\n      if(!angular.isArray(fileItem.blogPost.attachments)) {\n        fileItem.blogPost.attachments = [];\n      }\n      for (var i = 0; i < response.files.length; i++) {\n        fileItem.blogPost.attachments.push(response.files[i]);\n      }\n    };\n\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      $log.debug('[BlogBootstrapService.onProgressItem]', fileItem, progress);\n    };\n\n    editModal.$scope.upload = function(fileItem, blogPost) {\n      fileItem.blogPost = blogPost;\n      fileItem.upload();\n    };\n\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/blog/typechoosermodal.bootstrap.jade', show: false});\n    typeModal.$scope.chooseType = BlogService.chooseType;\n\n    editModal.$scope.$on('modal.hide.before',function(modalEvent, editModal) {\n      $log.debug(\"edit closed\", editModal.$scope.blogPost, editModal);\n      if(editModal.$scope.ok) {\n        // BlogService.saveOne(null, editModal.$scope.blogPost, null, page, function (err, result) {\n        //   editModal.$scope.blogPost = result\n        //   return BlogService.validate(editModal.$scope.blogPost, null, editModal.$scope.callback);\n        // });\n        return BlogService.validate(editModal.$scope.blogPost, null, editModal.$scope.callback);\n      } else {\n        if(editModal.$scope.callback) {\n          editModal.$scope.callback(\"discarded\", editModal.$scope.blogPost);\n        }\n      }\n    });\n\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getEditModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(blogPost, cb) {\n    $log.debug(\"[BlogService.edit]\", blogPost);\n    editModal.$scope.blogPost = blogPost;\n    editModal.$scope.callback = cb;\n    editModal.$scope.ok = false;\n\n    focus('blogposttitle');\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var createEdit = function(blogPosts, blogPost, cb) {\n    blogPost = BlogService.create(blogPost); \n    edit(blogPost, cb);\n  };\n\n  return {\n    edit: edit,\n    update: edit, // alias\n    createEdit: createEdit,\n    setModals: setModals,\n    openTypeChooserModal: openTypeChooserModal,\n  };\n});","angular.module('jumplink.cms.blog', [\n  'jumplink.cms.attachment',\n  'angularMoment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('BlogService', function (moment, $sailsSocket, $async, $log, $filter, AttachmentService) {\n\n  var types = ['news', 'other'];\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var deleteAttachmentLocally = AttachmentService.destroyLocally;\n\n  /**\n   * delete attachment extern / server\n   */\n  var deleteAttachmentExternally = AttachmentService.destroyExternally;\n\n  var deleteAttachment = AttachmentService.destroy;\n\n  var validate = function (blogPost, page, callback) {\n    if(blogPost.title) {\n      return fix(blogPost, page, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", blogPost);\n    }\n    return null;\n  };\n\n  var chooseType = function(blogPost, type) {\n    blogPost.type = type;\n  };\n\n  var removeFromClient = function (blogPosts, blogPost, callback) {\n    // $log.debug(\"removeFromClient\", blogPost);\n    var index = blogPosts.indexOf(blogPost);\n    if (index > -1) {\n      blogPosts.splice(index, 1);\n      if(angular.isFunction(callback)) {\n        callback(null, blogPosts);\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(\"no blogPost on client site found to remove\", blogPosts);\n      }\n    }\n  };\n\n  var destroy = function(blogPosts, blogPost, callback) {\n    // $log.debug(\"remove blogPost\", blogPost);\n    if(blogPost.id) {\n      $log.debug(\"[jumplink.cms.blog.BlogService.destroy]\", blogPost);\n      $sailsSocket.delete('/blog/'+blogPost.id).success(function(users, status, headers, config) {\n        removeFromClient(blogPosts, blogPost, callback);\n      });\n    } else {\n      removeFromClient(blogPosts, blogPost, callback);\n    }\n  };\n\n  var sort = function(blogPosts) {\n    var reverse = true;\n    return $filter('orderBy')(blogPosts, 'createdAt', reverse);\n  };\n\n  var transform = function(blogPosts) {\n    blogPosts = sort(blogPosts);\n    return blogPosts;\n  };\n\n  var append = function(blogPosts, moreBlogPosts, callback) {\n    blogPosts.push.apply(blogPosts, moreBlogPosts);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var prepent = function(blogPosts, blogPost, callback) {\n    blogPosts.unshift(blogPost);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var create = function(data) {\n    if(!data || !data.createdAt) {\n      data.createdAt = moment();\n    }\n    // if(!data || !data.updatedAt) data.createdAt = moment();\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.author) {\n      data.author = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    if(!data || !data.type) {\n      data.type = types[0]; // news\n    }\n    $log.debug(\"[BlogService,create]\", data);\n    return data;\n  };\n\n  var createEdit = function(blogPosts, blogPost, callback) {\n    blogPost = create(blogPost); \n    edit(blogPost, callback);\n  };\n\n  var fix = function(object, page, callback) {\n    if(angular.isUndefined(object.page) && page !== null) {\n      object.page = page;\n    }\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, page, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i], page);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(blogPosts, callback) {\n    $log.debug(\"[jumplink.cms.blog.BlogService.refresh]\");\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var saveOne = function (blogPosts, blogPost, index, page, callback) {\n    var errors = [\n      \"BlogService: Can't save blogPost.\",\n      \"BlogService: Can't save blogPost, blogPost to update not found.\",\n      \"BlogService: Can't save blogPost, parameters undefind.\",\n    ];\n    $log.debug(\"[BlogService.saveOne]\", blogPost);\n    if(angular.isDefined(blogPost) && angular.isDefined(callback)) {\n      blogPost = fix(blogPost, page);\n      if(angular.isUndefined(blogPost.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/blog', blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          callback(null, data);\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/blog/'+blogPost.id, blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          return callback(null, data);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      }\n    } else {\n      return callback(errors[2]);\n    }\n  };\n\n  var saveBlocks = function(blogPosts, page, callback) {\n    var errors = [\n      \"[BlogService.saveBlocks] Can't save blogPosts, parameters undefind.\"\n    ];\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPosts) && angular.isDefined(callback)) {\n      $async.map(blogPosts, function (blogPost, callback) {\n        saveOne(blogPosts, blogPost, null, page, callback);\n      }, function(err, blogPostsArray) {\n        if(err) {\n          return callback(err);\n        }\n        blogPosts = transform(blogPosts);\n        return callback(null, blogPosts);\n      });\n    } else {\n      $log.error(errors[0]);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0]);\n      }\n    }\n  };\n\n  var save = function(blogPosts, blogPost, index, page, callback) {\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPost)) {\n      saveOne(blogPosts, blogPost, index, page, callback);\n    } else { // save all blogPostBlocks\n      saveBlocks(blogPosts, page, callback);\n    }\n  };\n\n  var find = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/find', {page:page, limit:limit, skip:skip}).then (function (data) {\n      data.data = transform(data.data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on find \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var count = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/count', {page:page}).then (function (data) {\n      // $log.debug(data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data.count);\n      }\n      return data.data.count;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('blog', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              blogPost = msg.data;\n            }\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde erstellt', msg.data.title);\n          }\n          $scope.blogPosts.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    validate: validate,\n    subscribe: subscribe,\n    append: append,\n    prepent: prepent,\n    sort: sort,\n    transform: transform,\n    saveOne: saveOne,\n    saveBlocks: saveBlocks,\n    save: save,\n    fixEach: fixEach,\n    find: find,\n    resolve: find, // alias\n    count: count,\n    refresh: refresh,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: destroy, // alias\n    destroy: destroy,\n    deleteAttachment: deleteAttachment,\n    destroyAttachment: deleteAttachment, // alias\n    create: create\n  };\n});","angular.module('jumplink.cms.admin', [\n    'sails.io',\n  ])\n\n  .directive('adminbar', function ($compile, $window, $sailsSocket, $state) {\n\n    return {\n      restrict: 'E',\n      templateUrl: '/views/modern/adminbar.jade',\n      scope: {\n        upload : \"=?\",\n        download : \"=?\",\n        toogleHtml: \"=?\",\n        refresh: \"=?\",\n        save: \"=?\",\n        add: \"=?\",\n        addDropdown: \"=?\",\n        addDropdownActions: \"=?\",\n        adminSettingDropdown: \"=?\",\n        authenticated: \"=?\",\n        allowActions: \"=?\",\n      },\n      link: function ($scope, $element, $attrs) {\n\n        $scope.goToState = $state.go;\n\n        if(angular.isUndefined($scope.adminSettingDropdown)) {\n          $scope.adminSettingDropdown = [\n            {\n              \"text\": \"<i class=\\\"fa fa-list\\\"></i>&nbsp;Übersicht\",\n              \"click\": \"goToState('layout.administration')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-users\\\"></i>&nbsp;Benutzer\",\n              \"click\": \"goToState('layout.users')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-sign-out\\\"></i>&nbsp;Abmelden\",\n              \"click\": \"$root.logout()\"\n            }\n          ];\n        }\n      }\n    };\n  })\n\n;","angular.module('jumplink.cms.browser', [])\n.directive('jlBrowser', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/browser.bootstrap.jade',\n    scope: {\n      force: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      \n    }\n  };\n});","angular.module('jumplink.cms.bootstrap.content', [\n  'jumplink.cms.content',\n])\n/**\n * TODO move other bootstrap stuff from  ContentService to this ContentBootstrapService\n */\n.service('ContentBootstrapService', function ($log, $async, ImportExportBootstrapService, UtilityService, ContentService, SortableService) {\n  var modals = null;\n  var host = null;\n\n  var setHost = function (newHost) {\n    host = newHost;\n  };\n\n  var setupImportModal = function ($scope, onImportFinsih) {\n    var fileOptions = {};\n\n    var onCompleteFile = function (err, files) {\n      $log.debug(\"[ContentBootstrapService.onCompleteFile]\", files);\n      var data = [];\n      for (var i = 0; i < files.length; i++) {\n        data = data.concat(files[i].data);\n      }\n      ImportExportBootstrapService.setImports(data, {identifierKey: 'name', descriptionKey: 'title'});\n    };\n\n    var onImportStart = function (imports, next) {\n      $log.debug(\"[ContentBootstrapService.onImportStart]\", host);\n      $async.map(imports, function (item, callback) {\n        if(item.importOptions.doImport === true) {\n          ContentService.updateOrCreateByHostByTitleAndPage(host, item, callback);\n        } else {\n          callback();\n        }\n        \n      }, function(err, results) {\n        $log.debug(\"[ContentBootstrapService.onImportStart] done\", err, results);\n        results = SortableService.sort(results);\n        next(err, results);\n      });\n      \n    };\n\n    var onAbort = function (imports, next) {\n      $log.debug(\"[ContentBootstrapService.onAbort]\");\n      next();\n    };\n\n    modals = ImportExportBootstrapService.setModals($scope, fileOptions, onCompleteFile, onImportStart, onAbort, onImportFinsih);\n  };\n\n  return {\n    setHost: setHost,\n    setupImportModal: setupImportModal,\n    showImportModal: ImportExportBootstrapService.show,\n  };\n});","angular.module('jumplink.cms.content', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'ui.ace',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities',\n])\n.service('ContentService', function ($rootScope, $log, $sailsSocket, $filter, $modal, $download, JLSailsService, SortableService, UtilityService, focus, $async) {\n\n  var showHtml = false;\n  var editModal = null;\n\n  var getShowHtml = function() {\n    return showHtml;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({title: 'Inhaltsblock bearbeiten', templateUrl: '/views/modern/contentmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n    editModal.$scope.changeName = false;\n\n    editModal.$scope.$watch('content.title', function(newValue, oldValue) {\n      // $log.debug(\"Content in Content Modal changed!\", \"new\", newValue, \"old\", oldValue);\n      if(editModal.$scope.changeName && angular.isDefined(editModal.$scope.content)) {\n        editModal.$scope.content.name = generateName(newValue);\n      }\n    });\n\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      // $log.debug(\"edit closed\", event, editModal);\n      editModal.$scope.changeName = false;\n      if(editModal.$scope.ok) {\n        return validateContent(editModal.$scope.content, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.content);\n      }\n    });\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('content', function(msg){\n      $log.debug(\"Content event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Seite wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  var toogleShowHtml = function(contents, callback) {\n    showHtml = !showHtml;\n    if(showHtml && contents) {\n      contents = beautifyEach(contents);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, showHtml);\n    }\n    return showHtml;\n  };\n\n  var beautify = function(content, callback) {\n    content.content = html_beautify(content.content);\n    if(angular.isFunction(callback)) {\n      return callback(null, content);\n    }\n    return content;\n  };\n\n  var beautifyEach = function(contents, callback) {\n    for (var i = contents.length - 1; i >= 0; i--) {\n      contents[i].content = beautify(contents[i].content);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, contents);\n    }\n    return contents;\n  };\n\n  var getByName = function (contents, name) {\n    var index = UtilityService.findKeyValue(contents, 'name', name);\n    if(index > -1) {\n      return contents[index];\n    }\n    return null;\n  };\n\n  var create = function(data) {\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.type) {\n      data.type = \"dynamic\";\n    }\n    if(!data || !data.page) {\n      $log.error(\"[ContentService] Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(contents, content, callback) {\n    SortableService.append(contents, content, callback, true, 'name');\n  };\n\n  var createEdit = function(contents, page, callback) {\n    var data = create({page:page});\n    edit(data, callback, true);\n  };\n\n  var swap = function(contents, index_1, index_2, callback) {\n    return SortableService.swap(contents, index_1, index_2, callback);\n  };\n\n  var moveForward = function(index, contents, callback) {\n    return SortableService.moveForward(index, contents, callback);\n  };\n\n  var moveBackward = function(index, contents, callback) {\n    return SortableService.moveBackward(index, contents, callback);\n  };\n\n  var validateContent = function (content, callback) {\n    if(content.title) {\n      return fix(content, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", content);\n    }\n    return null;\n  };\n\n  var edit = function(content, callback, changeName) {\n    $log.debug(\"edit\", content);\n    editModal.$scope.content = content;\n    editModal.$scope.callback = callback;\n    if(changeName) {\n      editModal.$scope.changeName = changeName;\n    }\n    else {\n      editModal.$scope.changeName = false;\n    }\n    focus('contentedittitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var removeFromClient = function (contents, index, content, callback) {\n    return SortableService.remove(index, contents, callback);\n  };\n\n  var remove = function(contents, index, content, page, callback) {\n    var errors = [\n      'Content konnte nicht gelöscht werden.'\n    ];\n    if(typeof(index) === 'undefined' || index === null) {\n      index = contents.indexOf(content);\n    }\n    // remove from client\n    contents = SortableService.remove(contents, index, content);\n    // if content has an id it is saved on database, if not, not\n    if(content.id) {\n      $log.debug(\"remove from server, too\" ,content);\n      $sailsSocket.delete('/content/'+content.id+\"?page=\"+page, {id:content.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          return callback(data);\n        }\n        return data;\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        return callback(null, contents);\n      }\n      return contents;\n    }\n  };\n\n  var refresh = function(contents, callback) {\n    fixEach(contents, function(err, contents) {\n      if(err) {\n        $log.error(err);\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      beautifyEach(contents, function(err, contents) {\n        if(err) {\n          $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n          return err;\n        }\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      });\n    });\n  };\n\n  var generateName = function (title) {\n    var name = \"\";\n    if(title && title !== \"\") {\n      // Set content.name to content.title but only the letters in lower case\n      name = title.toLowerCase().replace(/[^a-z1-9]+/g, '');\n      $log.debug(\"set content.name to\", name);\n    }\n    return name;\n  };\n\n  /*\n   * Validate and fix content to make it saveable\n   */\n  var fix = function(content, callback) {\n\n    if(angular.isDefined(content)) {\n      if(angular.isUndefined(content.name) || content.name === '' || content.name === null) {\n        content.name = generateName(content.title);\n      }\n\n      if(!angular.isNumber(content.position)) {\n        content.position = 0;\n      }\n\n      if(!content.type || content.type === \"\") {\n        $log.warn(\"Fix content type not set, set it to dynamic\");\n        content.type = 'fix';\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        return callback(\"content not set\");\n      }\n      return null;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, content);\n    }\n    return content;\n  };\n\n  /*\n   * Validate and fix all contents to make them saveable\n   */\n  var fixEach = function(contents, callback) {\n    for (var i = contents.length - 1; i >= 0; i--) {\n      contents[i] = fix(contents[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, contents);\n    }\n    return contents;\n  };\n\n  var saveOne = function(content, page, callback) {\n    var errors = [\n      'Inhalt konnte nicht gespeichert werden'\n    ];\n    content.page = page;\n    fix(content, function(err, content) {\n      if(err) {\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      $sailsSocket.put('/content/replace', content).success(function(data, status, headers, config) {\n        //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n        if(data !== null && typeof(data) !== \"undefined\") {\n          content = data;\n          // $log.debug (content);\n          if(angular.isFunction(callback)) {\n            return callback(null, content);\n          }\n          return content;\n        } else {\n          $log.error(errors[0]);\n          if(angular.isFunction(callback)) {\n            return callback(errors[0]);\n          }\n          return errors[0];\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          return callback(data);\n        }\n        return data;\n      });\n    });\n  };\n\n  var save = function(contents, page, callback) {\n    var errors = [\n      'Seite konnte nicht gespeichert werden'\n    ];\n    fixEach(contents, function(err, contents) {\n      if(err) {\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      return $sailsSocket.put('/content/replaceall', {contents: contents, page: page}).success(function(data, status, headers, config) {\n        //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n        if(data !== null && typeof(data) !== \"undefined\") {\n          contents = $filter('orderBy')(data, 'position');\n          // $log.debug (data);\n          if(angular.isFunction(callback)) {\n            return callback(null, contents);\n          }\n          return contents;\n        }\n        $log.error(errors[0]);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0]);\n        }\n        return errors[0];\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    });\n  };\n  \n  var saveParallel = function(page, logger, options, obj, callback) {\n    $async.parallel(obj, function(err, results) {\n      if(err) {\n        $log.error(\"Error: On save content!\", err);\n        logger('error', 'Seiteninhalt konnte nichtgespeichert werden', err);\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      if(options.applyResults) {\n        options.scope = angular.extend(options.scope, results);\n      }\n      logger('success', 'Seiteninhalt wurde gespeichert', \"\");\n      if(angular.isFunction(callback)) {\n        return callback(null, results);\n      }\n      return results;\n    });\n  };\n\n  var findOne = function(page, name, type, callback, next) {\n    var errors = [\n      \"Error: On trying to find one with page: \"+page+\", name: \"+name,\n      \"request has more than one results\"\n    ];\n    var query = {\n      page: page,\n      name: name\n    };\n    var url = '/content/find';\n    if(angular.isDefined(type) && type !== null) {\n      query.type = type;\n    }\n    return $sailsSocket.put(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        return null;\n      }\n      if(data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.error(errors[1]);\n      }\n      // data.data.content = html_beautify(data.data.content);\n      if(next) {\n        data.data = next(data.data);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  var findAll = function(page, type, callback, next) {\n    var errors = [\n      \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n      \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n    ];\n    var query = {};\n    var url = '/content/findall';\n    if(angular.isDefined(page) && page !== null) {\n      query.page = page;\n    }\n    if(angular.isDefined(type) && type !== null) {\n      query.type = type;\n    }\n    return $sailsSocket.put(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(errors[1]);\n        return null;\n      }\n      // data.data.content = html_beautify(data.data.content);\n      data.data = $filter('orderBy')(data.data, 'position');\n      // $log.debug(data);\n      if(next) {\n        data.data = next(data.data);\n      }\n\n      if(angular.isFunction(callback)) {\n        callback(null, data.data);\n      } else {\n        return data.data;\n      }\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  /**\n   * For superadminsd\n   */\n  var findByHost = function(query, callback) {\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Content/findByHost', query, options, callback);\n  };\n\n  /**\n   * For superadminsd\n   */\n  var exportByHost = function(host, download, callback) {\n    // $log.debug(\"[ContentService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    \n    return JLSailsService.resolve('/Content/exportByHost', {host: host}, options, function(err, data) {\n      $log.debug(\"[ContentService.exportByHost]\", err, data);\n      if(err) {\n        if(download) {\n          $download(JSON.stringify(data), \"error.txt\", \"text/plain\");\n        }\n        return callback(err);\n      }\n      if(download) {\n        $download(JSON.stringify(data), \"content.json\", \"text/json\");\n      }\n      return callback(err, data);\n    });\n  };\n\n  /**\n   * Update or create content for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save content for\n   */\n  var updateOrCreateByHostByTitleAndPage = function(host, content, callback) {\n    $log.debug(\"[contentsService.updateOrCreateByHostByTitleAndPage]\", host, content);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Content/updateOrCreateByHostByTitleAndPage', {host: host, content: content}, options, callback);\n  };\n  /*\n   * get all contents for page including images for each content.name \n   */\n  var findAllWithImage = function(page, type, callback, next) {\n    // $log.debug(\"findAllWithImage\");\n    var errors = [\n      \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n      \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n    ];\n    var query = {\n      page: page\n    };\n    var url = '/content/findAllWithImage?page='+page;\n    if(type) {\n      query.type = type;\n      url = url+'&type='+type;\n    }\n    return $sailsSocket.get(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(errors[1]);\n        return null;\n      }\n      // data.data.content = html_beautify(data.data.content);\n      data.data.contents = $filter('orderBy')(data.data.contents, 'position');\n      data.data.images = $filter('orderBy')(data.data.images, 'position');\n      // $log.debug(data);\n      if(next) {\n        data.data = next(data.data);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  /**\n   *\n   */\n  var find = function(page, name, type, callback, next) {\n    //- get soecial content (one)\n    if(angular.isDefined(name)) {\n      return findOne(page, name, type, next);\n    // get all for page\n    } else {\n      return findAll(page, type, callback, next);\n    }\n  };\n\n  return {\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getShowHtml: getShowHtml,\n    toogleShowHtml: toogleShowHtml,\n    beautify: beautify,\n    beautifyEach: beautifyEach,\n    create: create,\n    createEdit: createEdit,\n    append: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    refresh: refresh,\n    fix: fix,\n    fixEach: fixEach,\n    save: save,\n    saveOne: saveOne,\n    saveParallel: saveParallel,\n    find: find,\n    resolve: find, // alias\n    findOne: findOne,\n    resolveOne: findOne, // alias\n    findAll: findAll, \n    resolveAll: findAll, //alias\n    findByHost: findByHost,\n    exportByHost: exportByHost,\n    updateOrCreateByHostByTitleAndPage: updateOrCreateByHostByTitleAndPage,\n    findAllWithImage: findAllWithImage,\n    resolveAllWithImage: findAllWithImage,  //alias\n    getByName: getByName\n  };\n});","angular.module('jumplink.cms.content.medium', [\n  'jumplink.cms.content',\n  'angular-medium-editor',\n])\n.value('mediumOptions', {\n  buttonLabels: \"fontawesome\",\n  toolbar: {\n    buttons: [\"bold\", \"italic\", \"underline\", \"anchor\", \"h2\", \"h3\", \"h4\", \"quote\", \"orderedlist\", \"unorderedlist\"]\n  }\n})\n.service('ContentMediumService', function ($rootScope, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n  // TODO\n  var Imager = function () {\n    this.button = document.createElement('button');\n    this.button.className = 'medium-editor-action';\n    this.button.innerText = 'Image';\n    this.button.innerHTML = '<i class=\"fa fa-picture-o\"></i>';\n    this.button.onclick = this.onClick.bind(this);\n    // this.classApplier = rangy.createCssClassApplier('highlight', {\n    //   elementTagName: 'mark',\n    //   normalize: true\n    // });\n  };\n  Imager.prototype.onClick = function() {\n    this.classApplier.toggleSelection();\n  };\n  Imager.prototype.getButton = function() {\n    return this.button;\n  };\n  Imager.prototype.checkState = function(node) {\n    if (node.tagName === 'MARK') {\n      this.button.classList.add('medium-editor-button-active');\n    }\n  };\n\n  return {\n    Imager: Imager\n  };\n})\n.directive('jlContent', function ($compile, $window, mediumOptions, ContentMediumService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/content.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      content: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n      if(angular.isUndefined($scope.mediumOptions)) {\n        $scope.mediumOptions = mediumOptions;\n      }\n      if(angular.isUndefined($scope.mediumBindOptions)) {\n        $scope.mediumBindOptions = {\n          extensions: {\n            'image': new ContentMediumService.Imager()\n          }\n        };\n      }\n    }\n  };\n})\n.directive('jlContentBlocks', function ($compile, $window, mediumOptions, ContentMediumService, SubnavigationService, HistoryService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/contentBlocks.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      contents: \"=\",\n      navs: \"=?\",\n      afterRefresh: \"=?\",\n      afterSave: \"=?\",\n      afterRemove: \"=?\",\n      afterEdit: \"=?\",\n      afterAdd: \"=?\",\n      subnavigation: \"=?\",\n      afterSaveNav: \"=?\",\n      afterRemoveNav: \"=?\",\n      afterEditNav: \"=?\",\n      afterAddNav: \"=?\",\n      logger: \"=\",\n      page: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, ContentService, $log, $state) {\n\n      ContentService.setEditModal($scope);\n      SubnavigationService.setEditModal($scope);\n      $scope.goTo = HistoryService.goToHashPosition;\n      ContentService.subscribe();\n      SubnavigationService.subscribe();\n      // SubnavigationService.resizeOnImagesLoaded();\n\n      if(angular.isUndefined($scope.page)) {\n        $scope.page = $state.current.name;\n      }\n\n      if(angular.isUndefined($scope.subnavigation)) {\n        $scope.subnavigation = false;\n      }\n\n      if(angular.isUndefined($scope.afterRefresh)) {\n        $scope.afterRefresh = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht erneuert!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock erneuert!\", \"\");\n        };\n      }\n\n      if(angular.isUndefined($scope.afterSave)) {\n        $scope.afterSave = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock gespeichert!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterRemove)) {\n        $scope.afterRemove = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht entfernt!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock entfernt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterEdit)) {\n        $scope.afterEdit = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht bearbeitet!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock bearbeitet!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterAdd)) {\n        $scope.afterAdd = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht hinzugefügt!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock hinzugefügt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterSaveNav)) {\n        $scope.afterSaveNav = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Navigation gespeichert!\", result.title);\n        };\n      }\n\n\n      $scope.add = function() {\n        var errors = [\n          \"Error: Konnte Inhaltsblock nicht erzeugen\",\n          \"Error: Konnte Inhaltsblock nicht hinzufügen\",\n        ];\n\n        var successes = [\n          \"Neuen Inhaltsblock erfolgreich hinzugefügt\",\n          \"Neue Subnavigation erfolgreich hinzugefügt\",\n          \"Neuen Block erfolgreich hinzugefügt\",\n        ];\n\n        if(!$scope.authenticated) {\n          return false;\n        }\n        // generates new content and opens the modal\n        ContentService.createEdit($scope.contents, $scope.page, function(err, content) {\n          if(err) {\n            return $scope.afterAdd(err);\n          }\n          ContentService.append($scope.contents, content, $scope.afterAdd);  \n        });\n      };\n\n      $scope.moveForward = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }       \n        SortableService.moveForward(index, $scope.contents, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On move content forward!\", err);\n            return err;\n          }\n          $scope.contents = contents;\n        });\n      };\n\n      $scope.moveBackward = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SortableService.moveBackward(index, $scope.contents, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On move content backward!\", err);\n            return err;\n          }\n          $scope.contents = contents;\n        });\n      };\n\n      $scope.edit = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.edit(content, $scope.afterEdit);\n      };\n\n      $scope.remove = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.remove($scope.contents, index, content, $scope.page, $scope.afterRemove);\n      };\n\n      $scope.refresh = function() {\n        ContentService.refresh($scope.contents, $scope.afterRefresh);\n      };\n\n      $scope.toggleHtml = function(index, content) {\n        content.html = content.html !== true;\n      };\n\n      $scope.save = function() {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.save($scope.contents, $scope.page, $scope.afterSave);\n        if($scope.subnavigation) {\n          SubnavigationService.save($scope.navs, $scope.page, $scope.afterSaveNav);\n        }\n      };\n    }\n  };\n});","// window.saveAs\n// Shims the saveAs method, using saveBlob in IE10. \n// And for when Chrome and FireFox get round to implementing saveAs we have their vendor prefixes ready. \n// But otherwise this creates a object URL resource and opens it on an anchor tag which contains the \"download\" attribute (Chrome)\n// ... or opens it in a new tab (FireFox)\n// @author Andrew Dodson\n// @copyright MIT, BSD. Free to clone, modify and distribute for commercial and personal use.\n// window.saveAs || ( window.saveAs = (window.navigator.msSaveBlob ? function(b,n){ return window.navigator.msSaveBlob(b,n); } : false) || window.webkitSaveAs || window.mozSaveAs || window.msSaveAs || (function(){\n//   // URL's\n//   window.URL || (window.URL = window.webkitURL);\n//   if(!window.URL){\n//     return false;\n//   }\n//   return function(blob,name){\n//     var url = URL.createObjectURL(blob);\n//     // Test for download link support\n//     if( \"download\" in document.createElement(\"a\") ){\n//       var a = document.createElement(\"a\");\n//       a.setAttribute(\"href\", url);\n//       a.setAttribute(\"download\", name);\n//       // Create Click event\n//       var clickEvent = document.createEvent (\"MouseEvent\");\n//       clickEvent.initMouseEvent (\"click\", true, true, window, 0, \n//         clickEvent.screenX, clickEvent.screenY, clickEvent.clientX, clickEvent.clientY, \n//         clickEvent.ctrlKey, clickEvent.altKey, clickEvent.shiftKey, clickEvent.metaKey, \n//         0, null);\n//       // dispatch click event to simulate download\n//       a.dispatchEvent (clickEvent);\n//     }\n//     else{\n//       // fallover, open resource in new tab.\n//       window.open(url, \"_blank\", \"\");\n//     }\n//   };\n// })() );\n\n// Source: https://github.com/darius/requestAnimationFrame\n// Adapted from https://gist.github.com/paulirish/1579671 which derived from\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik Möller.\n// Fixes from Paul Irish, Tino Zijdel, Andrew Mao, Klemen Slavič, Darius Bacon\n\n// MIT license\n\nif (!Date.now) {\n  Date.now = function() { return new Date().getTime(); };\n}\n\n(function() {\n    'use strict';\n\n    var vendors = ['webkit', 'moz'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame'] || window[vp+'CancelRequestAnimationFrame']);\n    }\n    // iOS6 is buggy\n    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\n        var lastTime = 0;\n        window.requestAnimationFrame = function(callback) {\n          var now = Date.now();\n          var nextTime = Math.max(lastTime + 16, now);\n          return setTimeout(function() { callback(lastTime = nextTime); }, nextTime - now);\n        };\n        window.cancelAnimationFrame = clearTimeout;\n    }\n}());","angular.module('jumplink.cms.config', [\n  'sails.io',\n])\n.service('ConfigService', function ($sailsSocket, $filter, $log) {\n  var resolve = function(page) {\n    return $sailsSocket.get('/config/find').then (function (data) {\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n  return {\n    resolve: resolve\n  };\n});","// https://github.com/rndme/download\nangular.module('ngDownload', [])\n.service('$download', function ($log) { \n  if(angular.isDefined(download)) {\n    return download;\n  } else {\n    $log.error(\"[ngDownload] download is not defined, please install it from https://github.com/rndme/download\");\n    return null;\n  }\n  \n});","angular.module('jumplink.cms.event', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'angularMoment',\n  'ngFocus',\n  'ngAsync',\n  'sails.io',\n  'jumplink.cms.utilities',\n])\n.service('EventService', function (moment, UtilityService, $sailsSocket, $async, $log, focus, $modal, FileUploader) {\n  var editModal = null;\n  var typeModal = null;\n  var types = ['lecture', 'panel discussion', 'travel', 'info', 'food', 'other'];\n  var page = null;\n\n  var validate = function (event, callback) {\n    if(event.title) {\n      return fix(event, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", event);\n    }\n    return null;\n  };\n\n  var chooseType = function(event, type, hide) {\n    event.type = type;\n    hide();\n  };\n\n  var openTypeChooserModal = function(event) {\n    typeModal.$scope.event = event;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n    \n    editModal = $modal({title: 'Ereignis bearbeiten', templateUrl: '/views/modern/events/editmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {};\n    }\n\n    var uploadOptions = {\n      url: 'timeline/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      fileItem.event.download = response.files[0].uploadedAs;\n    };\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      console.info('onProgressItem', fileItem, progress);\n    };\n    editModal.$scope.upload = function(fileItem, event) {\n      fileItem.event = event;\n      fileItem.upload();\n    };\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/events/typechoosermodal.jade', show: false});\n    typeModal.$scope.chooseType = chooseType;\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      $log.debug(\"edit closed\", event, editModal);\n      if(editModal.$scope.ok) {\n        return validate(editModal.$scope.event, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.event);\n      }\n    });\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getTypeModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(event, eventBlockName, callback) {\n    // $log.debug(\"edit\", event);\n    editModal.$scope.event = event;\n    // editModal.$scope.eventBlockName = eventBlockName;\n    editModal.$scope.callback = callback;\n    editModal.$scope.ok = false;\n    focus('eventtitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var split = function(events) {\n    var unknown = [], before = [], after = [];\n    for (var i = 0; i < events.length; i++) {\n      if(angular.isDefined(events[i].to)) {\n        events[i].to = moment(events[i].to);\n      }\n      if(angular.isDefined(events[i].from)) {\n        events[i].from = moment(events[i].from);\n        if(events[i].from.isAfter()) {\n          after.push(events[i]);\n        }\n        else {\n          before.push(events[i]);\n        }\n      } else {\n        unknown.push(events[i]);\n      }\n    }\n    return {unknown:unknown, before:before, after:after};\n  };\n\n  var removeFromClient = function (events, event, eventBlockName, callback) {\n    var errors = [\n      \"no event on client site found to remove\"\n    ];\n    var index = events[eventBlockName].indexOf(event);\n    if (index > -1) {\n      events[eventBlockName].splice(index, 1);\n      if(angular.isFunction(callback)) {\n        return callback(null, events);\n      }\n      return events;\n    }\n    if(angular.isFunction(callback)) {\n      return callback(errors[0], events);\n    }\n    return errors[0];\n  };\n\n  var remove = function(events, event, eventBlockName, callback) {\n    // $log.debug(\"remove event\", event, eventBlockName);\n    if(event.id) {\n      $log.debug(event);\n      $sailsSocket.delete('/timeline/'+event.id).success(function(users, status, headers, config) {\n        removeFromClient(events, event, eventBlockName, callback);\n      });\n    } else {\n      removeFromClient(events, event, eventBlockName, callback);\n    }\n  };\n\n  var transform = function(events) {\n    events = split(events);\n    events.before = UtilityService.invertOrder(events.before);\n    return events;\n  };\n\n  var merge = function(unknown, before, after) {\n    if(angular.isUndefined(unknown)) {\n      unknown = [];\n    }\n    if(angular.isUndefined(before)) {\n      before = [];\n    }\n    if(angular.isUndefined(after)) {\n      after = [];\n    }\n    return unknown.concat(before).concat(after);\n  };\n\n  var append = function(events, event, callback) {\n    events.unknown.push(event);\n    var allEvents = merge(events.unknown, events.before, events.after);\n    events = transform(allEvents);\n    if(angular.isFunction(callback)) {\n      return callback(null, events);\n    }\n    return events;\n  };\n\n  var create = function(data) {\n    if(!data || !data.from) {\n      data.from = moment();\n      data.from.add(1, 'hours');\n      data.from.minutes(0);\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.person) {\n      data.person = \"\";\n    }\n    if(!data || !data.place) {\n      data.place = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var createEdit = function(events, event, callback) {\n    event = create(event); \n    edit(event, null, callback);\n  };\n\n  var fix = function(object, callback) {\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(eventBlocks) {\n    var allEvents = merge(eventBlocks.unknown, eventBlocks.before, eventBlocks.after);\n    // $log.debug(\"allEvents.length\", allEvents.length);\n    eventBlocks = transform(allEvents);\n    // $log.debug(\"refreshed\");\n    return eventBlocks;\n  };\n\n  var saveOne = function (eventBlocks, eventBlockName, event, callback) {\n    var errors = [\n      \"EventService: Can't save event.\",\n      \"EventService: Can't save event, event to update not found.\",\n      \"EventService: Can't save event, parameters undefind.\",\n    ];\n    if(angular.isDefined(event) && angular.isDefined(eventBlockName) && angular.isDefined(callback)) {\n      event = fix(event);\n      if(angular.isUndefined(event.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/timeline', event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event created\", event, data);\n          var index = eventBlocks[eventBlockName].indexOf(event);\n          if (index > -1) {\n            eventBlocks[eventBlockName][index] = data;\n            // $log.debug(eventBlocks[eventBlockName][index]);\n            callback(null, eventBlocks[eventBlockName][index]);\n          } else {\n            callback(errors[1]);\n          }\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/timeline/'+event.id, event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event updated\", event, data);\n          event = data;\n          callback(null, event);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      }\n    } else {\n      callback(errors[2]);\n    }\n  };\n\n  var saveAllInBlock = function(eventBlocks, eventBlockName, callback) {\n    $async.map(eventBlocks[eventBlockName], function (event, callback) {\n      saveOne(eventBlocks, eventBlockName, event, callback);\n    }, callback);\n  };\n\n\n  var saveBlocks = function(eventBlocks, callback) {\n    var errors = [\n      \"EventService: Can't save eventBlocks, parameters undefind.\"\n    ];\n    // save just this event if defined\n    if(angular.isDefined(eventBlocks) && angular.isDefined(callback)) {\n      return $async.map(['after', 'before', 'unknown'], function (eventBlockName, callback) {\n        saveAllInBlock(eventBlocks, eventBlockName, callback);\n      }, function(err, eventBlocksArray) {\n        if(err) {\n           $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n        }\n        var allEvents = merge(eventBlocksArray[0], eventBlocksArray[1], eventBlocksArray[2]);\n        eventBlocks = transform(allEvents);\n        return callback(null, eventBlocks);\n      });\n    }\n    $log.error(errors[0]);\n    if(angular.isFunction(callback)) {\n      return callback(errors[0]);\n    }\n  };\n\n  var resolve = function(page) {\n    return $sailsSocket.get('/timeline').then (function (data) {\n      // $log.debug(data);\n      return transform(data.data);\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('timeline', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            event = msg.data;\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde erstellt', msg.data.title);\n          }\n          $scope.events.before.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    subscribe: subscribe,\n    split: split,\n    merge: merge,\n    append: append,\n    transform: transform,\n    saveOne: saveOne,\n    saveAllInBlock: saveAllInBlock,\n    saveBlocks: saveBlocks,\n    edit: edit,\n    createEdit: createEdit,\n    fixEach: fixEach,\n    resolve: resolve,\n    setModals: setModals,\n    refresh: refresh,\n    openTypeChooserModal: openTypeChooserModal,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: remove\n  };\n});","angular.module('jumplink.cms.fallback', [\n])\n.service('FallbackService', function ($window, $location, $log) {\n\n  var go = function(path) {\n    var protocol = $location.protocol();\n    var host = $location.host();\n    if(!angular.isString(path)) {\n      path = \"/fallback\";\n    } else {\n      if(path.charAt(0) !== '/') {\n        path = '/'+path;\n      }\n    }\n    var url = protocol+\"://\"+host+path+\"?force=fallback\";\n    $log.debug(\"Go to fallback url: \"+url);\n    // $window.location.href = url;\n  };\n\n  return {\n    go: go\n  };\n});","angular.module('ngFocus', [])\n// Source and Copyright: http://stackoverflow.com/questions/25596399/set-element-focus-in-angular-way\n.factory('focus', function($timeout, $window) {\n  return function(id) {\n    // timeout makes sure that it is invoked after any other event has been triggered.\n    // e.g. click events that need to run before the focus or\n    // inputs elements that are in a disabled state but are enabled when those events\n    // are triggered.\n    $timeout(function() {\n      var element = $window.document.getElementById(id);\n      if(element) {\n        element.focus();\n      }\n    });\n  };\n})\n.directive('eventFocus', function(focus) {\n  return function(scope, elem, attr) {\n    elem.on(attr.eventFocus, function() {\n      focus(attr.eventFocusId);\n    });\n\n    // Removes bound events in the element itself\n    // when the scope is destroyed\n    scope.$on('$destroy', function() {\n      elem.off(attr.eventFocus);\n    });\n  };\n});","if (typeof jumplink === 'undefined') {\n  var jumplink = {};\n}\n\n\njumplink.cms = angular.module('jumplink.cms', [\n  'ui.router',                 // AngularUI Router: https://github.com/angular-ui/ui-router\n  'ngAnimate',               // ngAnimate: https://docs.angularjs.org/api/ngAnimate\n  'ngSanitize',              // ngSanitize: https://docs.angularjs.org/api/ngSanitize\n  'sails.io',                // angularSails: https://github.com/balderdashy/angularSails\n  'webodf',                  // custom module\n  'FBAngular',               // angular-fullscreen: https://github.com/fabiobiondi/angular-fullscreen\n  'mgcrea.ngStrap',          // AngularJS 1.2+ native directives for Bootstrap 3: http://mgcrea.github.io/angular-strap/\n  'angularMoment',           // Angular.JS directive and filters for Moment.JS: https://github.com/urish/angular-moment\n  // 'wu.masonry,'              // A directive to use masonry with AngularJS: http://passy.github.io/angular-masonry/\n  'angular-carousel',        // An AngularJS carousel implementation optimised for mobile devices: https://github.com/revolunet/angular-carousel\n  // 'textAngular',             // A radically powerful Text-Editor/Wysiwyg editor for Angular.js: https://github.com/fraywing/textAngular\n  'angular-medium-editor',   // AngularJS directive for Medium.com editor clone: https://github.com/thijsw/angular-medium-editor\n  'ui.ace',                  // This directive allows you to add ACE editor elements: https://github.com/angular-ui/ui-ace\n  'leaflet-directive',       // AngularJS directive to embed an interact with maps managed by Leaflet library: https://github.com/tombatossals/angular-leaflet-directive\n  'toaster',                 // AngularJS Toaster is a customized version of \"toastr\" non-blocking notification javascript library: https://github.com/jirikavi/AngularJS-Toaster\n  'angularFileUpload',       // Angular File Upload is a module for the AngularJS framework: https://github.com/nervgh/angular-file-upload\n  'angular-filters',         // Useful filters for AngularJS: https://github.com/niemyjski/angular-filters\n  'ngDraggable',             // Drag and drop module for Angular JS: https://github.com/fatlinesofcode/ngDraggable\n  'toggle-switch',           // AngularJS Toggle Switch: https://github.com/JumpLink/angular-toggle-switch\n  'ngAsync',\n  'ngFocus',\n  'jumplink.cms.history',\n  'jumplink.cms.content',\n  'jumplink.cms.content.medium',\n  'jumplink.cms.sortable',\n  'jumplink.cms.utilities',\n  'jumplink.cms.subnavigation',\n  'jumplink.cms.info',\n  'jumplink.cms.config',\n  'jumplink.cms.event',\n  'jumplink.cms.user',\n  'jumplink.cms.theme',\n  'jumplink.cms.gallery',\n  'jumplink.cms.admin',\n  'jumplink.cms.session',\n  'jumplink.cms.routes',\n  'jumplink.cms.sidebar',\n  'jumplink.cms.toolbar',\n  'jumplink.cms.browser',\n  'jumplink.cms.bootstrap.signin',\n  'angular-preload-image',          // A simple AngularJS module to make it easy to pre-load images to prevent the horrible waterfall effect: https://github.com/RevillWeb/angular-preload-image\n]);","angular.module('jumplink.cms.history', [\n  'ui.router',\n])\n/**\n * @see: https://github.com/angular-ui/ui-router/issues/92\n */\n.service('HistoryService', function ($window, $location, $state, $anchorScroll, $timeout, $log) {\n  var history = [];\n  var push = function(state, params) {\n    history.push({ state: state, params: params });\n  };\n\n  var all = function() {\n    return history;\n  };\n\n  var go = function(step) {\n    $log.debug('[jumplink.cms.history.HistoryService], history.length', history.length, 'step', step, 'history.length + step =', history.length + step);\n    // If the past has not been saved as far as the steps that we want to go back, then go to the beginning of time\n    if(history.length + step <= 0) {\n     return $location.path('/');\n    }\n    // TODOlocation    // (1) Determine # of states in stack with URLs, attempt to\n    //    shell out to $window.history when possible\n    // (2) Attempt to figure out some algorthim for reversing that,\n    //     so you can also go forward\n    var prev = this.previous(step || -1);\n    return $state.go(prev.state, prev.params);\n  };\n\n  var previous = function(step) {\n    return history[history.length - Math.abs(step || 1)];\n  };\n\n  var back = function() {\n    return this.go(-1);\n  };\n\n  var goToHashPosition = function (hash) {\n    // $log.debug(\"go to hash\", hash);\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n  var autoScroll = function () {\n    var hash = $location.hash();\n    // $log.debug(\"hash\", hash);\n    if(hash) {\n      // WORKAROUND\n      $timeout(function(){ goToHashPosition(hash); }, 1000); // TODO smooth?\n    } else {\n      $anchorScroll();\n    }    \n  };\n\n  return {\n    push: push,\n    all: all,\n    go: go,\n    previous: previous,\n    back: back,\n    goToHashPosition: goToHashPosition,\n    autoScroll: autoScroll\n  };\n\n})\n.run(function(HistoryService, $state, $rootScope) {\n\n  $rootScope.$on(\"$stateChangeSuccess\", function(event, to, toParams, from, fromParams) {\n    if (!from.abstract) {\n      HistoryService.push(from, fromParams);\n    }\n  });\n  console.log(HistoryService);\n  HistoryService.push($state.current, $state.params);\n\n});","angular.module('jumplink.cms.bootstrap.importexport', [\n  'jumplink.cms.importexport',\n  'jumplink.cms.bootstrap.uploader',\n  'mgcrea.ngStrap',\n  'ngFocus',\n])\n\n.service('ImportExportBootstrapService', function ($log, focus, $modal, FileUploader) {\n\n  var uploadModal = null;\n  \n\n  /**\n   * Setup the upload modal\n   */\n  var setModals = function($scope, fileOptions, onCompleteItemCallback, onImportStart, onAbort, onImportFinsih) {\n\n    uploadModal = $modal({title: 'JSON importieren', templateUrl: '/views/modern/uploadmodal.bootstrap.jade', show: false});\n    uploadModal.$scope.fileOptions = fileOptions;\n    uploadModal.$scope.imports = [];\n\n    uploadModal.$scope.ok = false;\n    uploadModal.$scope.import = function (hide) {\n      uploadModal.$scope.ok = true;\n\n      if(angular.isFunction(onImportStart)) {\n        onImportStart(uploadModal.$scope.imports, function (err, results) {\n          if(angular.isFunction(onImportFinsih)) {\n            onImportFinsih(err, results);\n          }\n          uploadModal.$scope.imports = [];\n          hide();\n        });\n      } else {\n        $log.warn(\"[ImportExportBootstrapService.abort] onImportStart is not defined!\");\n        uploadModal.$scope.imports = [];\n        hide();\n      }\n\n    };\n    uploadModal.$scope.abort = function (hide) {\n      uploadModal.$scope.ok = false;\n      uploadModal.$scope.imports = [];\n\n      if(angular.isFunction(onAbort)) {\n        onAbort(uploadModal.$scope.imports, function (err) {\n          hide();\n        });\n      } else {\n        $log.warn(\"[ImportExportBootstrapService.abort] onAbort is not defined!\");\n        hide();\n      }\n\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(uploadModal.$scope.fileOptions)) {\n      uploadModal.$scope.fileOptions = {};\n    }\n\n    uploadModal.$scope.uploadOptions = {\n      url: 'importexport/upload',\n      removeAfterUpload: true,\n      alias: 'import',\n\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(uploadModal.$scope.fileOptions)\n      }\n    };\n\n    uploadModal.$scope.onCompleteItem = function (err, files) {\n      $log.debug(\"[ImportExportBootstrapService.onCompleteItem]\");\n      if(angular.isFunction(onCompleteItemCallback)) {\n        onCompleteItemCallback(err, files);\n      }\n    };\n    uploadModal.$scope.onCompleteAll = function (err, result) {\n      $log.debug(\"[ImportExportBootstrapService.onCompleteAll]\");\n    };\n\n    // uploadModal.$scope.uploader = new FileUploader($scope.uploadOptions);\n\n\n    uploadModal.$scope.upload = function(fileItem) {\n      fileItem.upload();\n    };\n\n    uploadModal.$scope.$on('modal.hide.before',function(modalEvent, uploadModal) {\n      $log.debug(\"edit closed\", uploadModal.$scope, uploadModal);\n      if(uploadModal.$scope.ok) {\n\n        uploadModal.$scope.callback(null, uploadModal.$scope);\n      } else {\n        if(uploadModal.$scope.callback) {\n          uploadModal.$scope.callback(\"discarded\", uploadModal.$scope);\n        }\n      }\n    });\n\n    return getModals();\n  };\n\n  var getUploadModal = function() {\n    return uploadModal;\n  };\n\n  var getModals = function() {\n    return {\n      uploadModal: getUploadModal(),\n    };\n  };\n\n  /**\n   * Show the upload modal to upload files\n   */\n  var show = function(callback) {\n    $log.debug(\"[BlogService.show]\");\n    uploadModal.$scope.callback = callback;\n    uploadModal.$scope.ok = false;\n    focus('blogposttitle');\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    uploadModal.$promise.then(uploadModal.show);\n  };\n\n  var setImports = function (data, options) {\n    uploadModal.$scope.imports = uploadModal.$scope.imports.concat(data);\n    for (var i = uploadModal.$scope.imports.length - 1; i >= 0; i--) {\n      uploadModal.$scope.imports[i].importOptions = {\n        doImport: true,\n        identifier: uploadModal.$scope.imports[i][options.identifierKey],\n        description: uploadModal.$scope.imports[i][options.descriptionKey],\n      };\n    }  \n  };\n\n  return {\n    show: show,\n    setModals: setModals,\n    setImports: setImports,\n  };\n});","angular.module('jumplink.cms.importexport', [\n  'jumplink.cms.attachment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('ImportExportService', function ($sailsSocket, $async, $log, $filter) {\n\n\n  return {\n\n  };\n});","angular.module('jumplink.cms.gallery', [\n  'mgcrea.ngStrap',\n  'ngAsync',\n  'angular-medium-editor',\n  'FBAngular',\n  'sails.io',\n  'angularFileUpload',\n  'jumplink.cms.sortable',\n  'jumplink.cms.content',\n])\n.service('GalleryService', function ($rootScope, $sailsSocket, $async, $filter, Fullscreen, SortableService, ContentService, FileUploader, $modal, $log) {\n\n  var editModal = null;\n  uploadModal = null;\n  fullscreenImage = null;\n\n  var dropdown = [\n    {\n      \"text\": \"<i class=\\\"fa fa-eye\\\"></i>&nbsp;Anzeigen\",\n      \"click\": \"goToImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-edit\\\"></i>&nbsp;Bearbeiten\",\n      \"click\": \"editImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-trash\\\"></i>&nbsp;Löschen\",\n      \"click\": \"$dropdown.hide();$dropdown.destroy();removeImage(image);\" // TODO delay\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-floppy-o\\\"></i>&nbsp;Speichern\",\n      \"click\": \"saveImage(image)\"\n    }\n  ];\n\n  var getDropdown = function () {\n    return dropdown;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Bild bearbeiten', templateUrl: '/views/modern/gallery/editmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var prepairUploadModal = function (uploadModal, imageBlocks, contentBlocks) {\n    \n    uploadModal.$scope.imageBlocks = imageBlocks;\n    uploadModal.$scope.selects = getSelects(imageBlocks, contentBlocks);\n    if(uploadModal.$scope.selects.length > 0) {\n      $rootScope.selectedContentBlock = uploadModal.$scope.selects[0].value;\n    }\n\n    $rootScope.$watch('selectedContentBlock', function(newValue, oldValue) {\n      $log.debug(\"selected changed to\", newValue);\n    });\n\n    return uploadModal;\n  };\n\n  var setUploadModal = function($scope, imageBlocks, contentBlocks, options, callback, onCompleteCallback) {\n\n    // if options not set, set to default values\n    if(angular.isUndefined(options)) {\n      options = {\n        thumbnail: {\n          width: 300,\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'gallery/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(options)\n      }\n    };\n\n    $scope.uploader = new FileUploader(uploadOptions);\n    $scope.uploader.filters.push({\n      name: 'imageFilter',\n      fn: function(item /*{File|FileLikeObject}*/, options) {\n        var type = '|' + item.type.slice(item.type.lastIndexOf('/') + 1) + '|';\n        return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;\n      }\n    });\n\n    if(angular.isFunction(onCompleteCallback)) {\n      $scope.uploader.onComplete = onCompleteCallback;\n    }\n\n    $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      //fileItem.member.image = response.files[0].uploadedAs;\n      $log.debug(\"[GalleryService.uploader.onCompleteItem]\",fileItem, response, status, headers);\n      // WORKAROUND until the socket method works\n      response.files.forEach(function (file, index, files) {\n\n        var selected = $rootScope.selectedContentBlock;\n        var imageBlocks = uploadModal.$scope.imageBlocks;\n        var currentImages = imageBlocks[selected];\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] selected\", selected, \"imageBlocks\", imageBlocks, \"currentImages\", currentImages);\n\n        var last_position = 0;\n        if(currentImages.length > 0) {\n          last_position = currentImages[currentImages.length-1].position;\n        }\n        if($rootScope.authenticated) {\n          $rootScope.pop('success', 'Ein Bild wurde hochgeladen', file.original.name);\n        }\n        if(typeof file.position === 'undefined') {\n          last_position++;\n          file.position = last_position;\n          file.content = selected;\n        }\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] file\", file);\n        \n        currentImages.push(file);\n      });\n    };\n\n    $scope.upload = function(fileItem, image) {\n      fileItem.image = image;\n      fileItem.upload();\n    };\n\n    uploadModal = $modal({scope: $scope, title: 'Bilder hinzufügen', uploader: $scope.uploader, templateUrl: '/views/modern/gallery/uploadimagesmodal.jade', show: false});\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    if(angular.isFunction(callback)) {\n      return callback(getUploadModal());\n    }\n    return getUploadModal();\n  };\n\n  var getSelects = function (imageBlocks, contentBlocks) {\n    var blockNames = Object.keys(imageBlocks);\n    var result = [];\n    // console.log(\"contentBlocks\", contentBlocks);\n    blockNames.forEach(function (blockName, index, array) {\n      var label = ContentService.getByName(contentBlocks, blockName).title || blockName; // TODO WARNING slow!\n      result.push({\n        label: label,\n        value: blockName\n      });\n    });\n    return result;\n  };\n\n  var getUploadModal = function() {\n    return uploadModal;\n  };\n\n  var fix = function(image, page, contentname, callback) {\n    if(!image.page || image.page === \"\") {\n      image.page = page;\n    }\n\n    if(!image.content || image.content === \"\") {\n      image.content = contentname;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, image);\n    }\n    return image;\n  };\n\n  // var setFullScreen = function(image) {\n  //   // http://stackoverflow.com/questions/21702375/angularjs-ng-click-over-ng-click\n  //   fullscreenImage = image;\n  // }\n\n  // var closeFullScreen = function(image) {\n  //   Fullscreen.cancel();\n  // }\n\n  // Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n  //   if(!isFullscreenEnabled) {\n  //     delete fullscreenImage;\n  //   }\n  //   $scope.$apply();\n  // });\n\n  // var isFullScreen = function(image) {\n  //   if(angular.isDefined($scope.fullscreenImage) && angular.isDefined($scope.fullscreenImage.original) && angular.isDefined($scope.fullscreenImage.original.name) && $scope.fullscreenImage.original.name == image.original.name) {\n  //     return true;\n  //   } else {\n  //     return false;\n  //   }\n  // }\n\n  var saveOne = function(image, page, contentname, callback) {\n    image = fix(image, page, contentname);\n    var errors = [\n      'Bild konnte nicht gespeichert werden'\n    ];\n    $sailsSocket.put('/gallery/'+image.id, image).success(function(data, status, headers, config) {\n      if(angular.isArray(data)) {\n        data = data[0];\n      }\n      if(angular.isFunction(callback)) {\n        callback(null, data);\n      }\n    }).\n    error(function(data, status, headers, config) {\n      $log.error (errors[0], data);\n      if(angular.isFunction(callback)) {\n        callback(errors[0], data);\n      }\n    });\n  };\n\n  var saveAllBlocks = function(imageBlocks, page, callback) {\n    var blockNames = Object.keys(imageBlocks);\n    // $log.debug(\"saveAllBlocks\",\"blockNames\" , blockNames);\n\n    $async.map(blockNames,\n    function iterator(contentname, callback) {\n      saveAll(imageBlocks[contentname], page, contentname, callback);\n    }, callback);\n\n    // $async.map(images,\n    // function iterator(image, callback) {\n    //   saveOne(image, page, contentname, callback);\n    // }, callback);\n  };\n\n  var saveAll = function(images, page, contentname, callback) {\n    $async.map(images,\n    function iterator(image, callback) {\n      saveOne(image, page, contentname, callback);\n    }, callback);\n  };\n\n  var remove = function(images, index, image, page, callback) {\n    if(typeof(index) === 'undefined' || index === null) {\n      index = images.indexOf(image);\n    }\n    images = SortableService.remove(images, index, image);\n    // if image has an id it is saved on database, if not, not\n    if(image.id) {\n      // $log.debug(\"remove from server, too\" ,image);\n      $sailsSocket.delete('/gallery/'+image.id+\"?filename=\"+image.original.name+\"&page=\"+page, {id:image.id, filename:image.original.name, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          callback(null, images);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(null, images);\n      }\n    }\n  };\n\n  var add = function(imageBlocks, contentBlocks, callback) {\n    // $log.debug(\"add\");\n    uploadModal.$promise.then(uploadModal.show);\n\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    uploadModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"upload modal closed\");\n      if(angular.isFunction(callback)) {\n        callback(null);\n      }\n    });\n  };\n\n  // Images for Content\n  var addBlock = function(imageBlocks, content, callback) {\n    imageBlocks[content.name] = [];\n    if(angular.isFunction(callback)) {\n      return callback(null, imageBlocks[content.name]);\n    }\n    return imageBlocks[content.name];\n  };\n\n  var edit = function(image, callback) {\n    $log.debug(\"edit\", image);\n    editModal.$scope.image = image;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    editModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"edit closed\");\n      if(angular.isFunction(callback)) {\n        callback(null, editModal.$scope.image);\n      }\n    });\n  };\n\n  var aspect = function (image, width)  {\n    var height, scale, aspectRatio, win, paddingTopBottom = 0, paddingLeftRight = 0;\n    if($scope.isFullScreen(image)) {\n      // customised jQuery Method of http://css-tricks.com/perfect-full-page-background-image/\n      aspectRatio = image.original.width / image.original.height;\n      win = $rootScope.getWindowDimensions();\n      if(win.width / win.height < aspectRatio) {\n        width = win.width; // width 100%\n        scale = image.original.width / width;\n        height = image.original.height / scale;\n        paddingTopBottom = (win.height - height) / 2;\n        height = win.height;\n      } else {\n        height = win.height;  // height 100%\n        scale = image.original.height / height;\n        width = image.original.width / scale;\n        paddingLeftRight = (win.width - width) / 2;\n        width = win.width;\n      }\n      return {width: width+'px', height: height+'px', 'padding-right': paddingLeftRight+\"px\", 'padding-left': paddingLeftRight+\"px\", 'padding-top': paddingTopBottom+\"px\", 'padding-bottom': paddingTopBottom+\"px\" };\n    } else {\n      scale = image.original.width / width;\n      height =  image.original.height / scale;\n      return {width: width+'px', height: height+'px'};\n    }\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('gallery', function(msg) {\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $log.debug('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n            // $rootScope.pop('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n          }\n        break;\n        case 'created':\n          // TODO not broadcast / fired why?!\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hochgeladen', msg.data.original.name);\n          }\n          $scope.images.push(msg.data);\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde entfernt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n        case 'destroyed':\n          // if($rootScope.authenticated) {\n          //   $rootScope.pop('success', 'Ein Bild wurde gelöscht', \"\");\n          // }\n          $log.debug(msg.data);\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hinzugefügt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n      }\n    });\n  };\n\n  var resolve = function(page, content) {\n    var url = '/gallery?limit=0&page='+page;\n    if(content) {\n      url = url+'&content='+content;\n    }\n    return $sailsSocket.get(url).then (function (data) {\n      return $filter('orderBy')(data.data, 'position');\n    }, function error (resp) {\n      $log.error(resp);\n    });\n  };\n\n  return {\n    getDropdown: getDropdown,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    setUploadModal: setUploadModal,\n    getUploadModal: getUploadModal,\n    saveOne: saveOne,\n    saveAll: saveAll,\n    saveAllBlocks: saveAllBlocks,\n    remove: remove,\n    add: add,\n    addBlock: addBlock,\n    edit: edit,\n    aspect: aspect,\n    subscribe: subscribe,\n    resolve: resolve\n  };\n});","angular.module('jumplink.cms.info', [\n  'sails.io',\n])\n\n.service('CmsService', function ($log, $sailsSocket) {\n\n  var info = function(url, callback) {\n    var errors = [\n      \"[CmsService] Error: On trying to get cms info, url: \"+url,\n      \"[CmsService] Error: Result is null, url: \"+url\n    ];\n    var warns = [\n      \"[CmsService] Warn: Request has more than one results, url: \"+url\n    ];\n    return $sailsSocket.get(url).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        if(angular.isFunction(callback)) {\n          return callback(errors[1]);\n        }\n        return null;\n      }\n      if (data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.warn(warns[0]);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  // CMS Info for Users\n  var infoUser = function(callback) {\n    return info('/cms/infouser', callback);\n  };\n\n  var infoAdmin = function(callback) {\n    return info('/cms/infoadmin', callback);\n  };\n\n  var restart = function(callback) {\n    return $sailsSocket.post('/cms/restart').then (function (data) {\n      $log.debug(\"[CmsService.restart]\", data);\n      return callback(null, data);\n    }, function error (resp){\n      $log.error(\"[CmsService.restart]\", resp);\n      return callback(resp);\n    });\n  };\n\n\n  /**\n   * Public functions\n   */\n  return {\n    infoUser: infoUser,\n    infoAdmin: infoAdmin,\n    restart: restart,\n  };\n});","angular.module('jumplink.cms.multisite', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('MultisiteService', function ($rootScope, JLSailsService, $log) {\n\n  var resolve = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolve]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/find', query, options, callback);\n  };\n\n  var resolveNames = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findnames', query, options, callback);\n  };\n\n  var resolveHosts = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findhosts', query, options, callback);\n  };\n\n  return {\n    resolve: resolve,\n    resolveNames: resolveNames,\n    resolveHosts: resolveHosts\n  };\n});","angular.module('jumplink.cms.bootstrap.routes', [\n  'jumplink.cms.routes',\n  'jumplink.cms.bootstrap.importexport',\n])\n.service('RoutesBootstrapService', function ($log, $async, ImportExportBootstrapService, UtilityService, RoutesService, SortableService) {\n  var modals = null;\n  var host = null;\n\n  var setHost = function (newHost) {\n    host = newHost;\n  };\n\n  var setupImportModal = function ($scope, onImportFinsih) {\n    var fileOptions = {};\n\n    var onCompleteFile = function (err, files) {\n      $log.debug(\"[RoutesBootstrapService.onCompleteFile]\", files);\n      var data = [];\n      for (var i = 0; i < files.length; i++) {\n        data = data.concat(files[i].data);\n      }\n      ImportExportBootstrapService.setImports(data, {identifierKey: 'objectName', descriptionKey: 'title'});\n    };\n\n    var onImportStart = function (imports, next) {\n      $log.debug(\"[RoutesBootstrapService.onImportStart]\", host);\n      $async.map(imports, function (item, callback) {\n        if(item.importOptions.doImport === true) {\n          RoutesService.updateOrCreateByHostByObjectNameAndNavbar(host, item, callback);\n        } else {\n          callback();\n        }\n        \n      }, function(err, results) {\n        $log.debug(\"[RoutesBootstrapService.onImportStart] done\", err, results);\n        results = SortableService.sort(results);\n        next(err, results);\n      });\n      \n    };\n\n    var onAbort = function (imports, next) {\n      $log.debug(\"[RoutesBootstrapService.onAbort]\");\n      next();\n    };\n\n    modals = ImportExportBootstrapService.setModals($scope, fileOptions, onCompleteFile, onImportStart, onAbort, onImportFinsih);\n  };\n\n  return {\n    setHost: setHost,\n    setupImportModal: setupImportModal,\n    showImportModal: ImportExportBootstrapService.show,\n  };\n\n});","angular.module('jumplink.cms.routes', [\n  'ui.router',                 // AngularUI Router: https://github.com/angular-ui/ui-router\n  'jumplink.cms.sails',\n  'jumplink.cms.sortable',\n  'jumplink.cms.utilities',\n  'ngDownload'\n])\n.provider('jlRoutes', function jlRoutesProvider($stateProvider, $urlRouterProvider, $locationProvider) {\n\n  this.html5Mode = $locationProvider.html5Mode;\n\n  this.otherwise = $urlRouterProvider.otherwise;\n\n  this.state = $stateProvider.state;\n\n  this.when = function (url1, url2) {\n    $urlRouterProvider.when(url1, url2);\n  };\n\n  this.setLayouts = function(layouts) {\n    for (var stateName in layouts ) {\n      this.state(stateName, layouts[stateName]);\n    }\n  };\n\n  this.setRoutes = function(routes, routeOptions) {\n    /**\n     * Load optional addional states.\n     * WARNING: Very experimental and dangerous.\n     */\n    for (var i = 0; i < routes.length; i++) {\n      // if is Main Route\n      if(routes[i].main) {\n        var options = {};\n        // set state main url\n        if(typeof(routes[i].url) === 'string' && routes[i].url.length > 0) {\n          options.url = routes[i].url;\n        }\n        // WARNING custom states are very experimental\n        if(routes[i].customstate === true) {\n          // TODO Dirty hack!\n          if(angular.isDefined(routes[i].state.resolve) && typeof(routes[i].state.resolve) === 'string' && routes[i].state.resolve.length > 0) {\n            /* jshint ignore:start */\n            eval(routes[i].state.resolve);\n            /* jshint ignore:end */\n            options.resolve = resolve;\n          }\n          // TODO Dirty hack!\n          if(angular.isDefined(routes[i].state.views) && typeof(routes[i].state.views) === 'string' && routes[i].state.views.length > 0) {\n            /* jshint ignore:start */\n            eval(routes[i].state.views);\n            /* jshint ignore:end */\n            options.views = view;\n          }\n        // states wich are defined in routeOptions\n        } else {\n          // set state options\n          if(angular.isDefined(routes[i].objectName) && angular.isDefined(routeOptions[routes[i].objectName])) {\n            // console.log(routeOptions[routes[i].objectName]);\n            if(angular.isObject(routeOptions[routes[i].objectName].resolve)) {\n              options.resolve = routeOptions[routes[i].objectName].resolve;\n            }\n            if(angular.isObject(routeOptions[routes[i].objectName].views)) {\n              options.views = routeOptions[routes[i].objectName].views;\n            }\n            \n          } else {\n            console.error(\"objectName \"+routes[i].objectName+\" not found for route \"+routes[i]);\n          } \n        }\n        // If options are set, init state\n        if(angular.isDefined(options.url) && angular.isDefined(options.views)) {\n          // console.log(\"New Route\", routes[i].state.name, options);\n          $stateProvider.state(routes[i].state.name, options);\n        }\n        //set alternative urls as redirects\n        if(angular.isArray(routes[i].alternativeUrls)) {\n          for (var a = 0; a < routes[i].alternativeUrls.length; a++) {\n            // e.g. $urlRouterProvider.when('/referenzen', '/referenzen/uebersicht');\n            console.log(\"New redirect: \"+routes[i].alternativeUrls[a]+\" -> \"+routes[i].url);\n            $urlRouterProvider.when(routes[i].alternativeUrls[a], routes[i].url);\n          }\n        }\n      } else {\n        // if route is not a main route\n        // if(typeof(routes[i].url) === 'string' && routes[i].url.length > 0) {\n        //   options.url = routes[i].url;\n        //   $urlRouterProvider.when(routes[i].alternativeUrls[a], routes[i].url);\n        // }\n        \n      }\n    }\n  };\n\n\n  this.$get = function jlRoutesFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlRoutes();\n  };\n})\n.filter('showOnlyMainRoutes', function() {\n  // In the return function, we must pass in a single parameter which will be the data we will work on.\n  // We have the ability to support multiple other parameters that can be passed into the filter optionally\n  return function(routes, active) {\n    if(active !== true) {\n      return routes;\n    }\n    var result = [];\n    for (var i = 0; i < routes.length; i++) {\n      if(routes[i].main === true) {\n        result.push(routes[i]);\n      }\n    }\n    return result;\n  };\n})\n.service('RoutesService', function ($rootScope, $download, JLSailsService, $log, SortableService, UtilityService) {\n\n  var create = function(data) {\n    $log.debug(\"[RoutesService.create] data\", data);\n    if(!angular.isObject(data)) {\n      data = {};\n    }\n    if(!angular.isString(data.match)) {\n      data.match = \"\";\n    }\n    if(!angular.isString(data.title)) {\n      data.title = \"\";\n    }\n    if(data.main !== true && data.main !== false) {\n      data.main = false;\n    }\n    if(!angular.isString(data.url)) {\n      data.url = \"\";\n    }\n    if(!angular.isArray(data.alternativeUrls)) {\n      data.alternativeUrls = [];\n    }\n    if(angular.isUndefined(data.state) || !angular.isObject(data.state)) {\n      data.state = {};\n    }\n    if(!angular.isString(data.state.name)) {\n      data.state.name = \"\";\n    }\n    if(data.state.customstate !== true && data.state.customstate !== false) {\n      data.state.customstate = false;\n    }\n    if(!angular.isString(data.state.url)) {\n      data.state.url = \"\";\n    }\n    if(!angular.isString(data.state.views)) {\n      data.state.views = \"\";\n    }\n    if(!angular.isString(data.state.resolve)) {\n      data.state.resolve = \"\";\n    }\n    if(!angular.isObject(data.fallback)) {\n      data.fallback = {};\n    }\n    if(!angular.isString(data.fallback.url)) {\n      data.fallback.url = \"\";\n    }\n    return data;\n  };\n\n  var append = function(routes, data, callback) {\n    $log.debug(\"[RoutesService] data before\", data);\n    data = create(data);\n    $log.debug(\"[RoutesService] data after\", data);\n    SortableService.append(routes, data, callback);\n  };\n\n  var swap = function(routes, index_1, index_2, callback) {\n    return SortableService.swap(contents, index_1, index_2, callback);\n  };\n\n  var moveForward = function(index, routes, callback) {\n    return SortableService.moveForward(index, routes, callback);\n  };\n\n  var moveBackward = function(index, routes, callback) {\n    return SortableService.moveBackward(index, routes, callback);\n  };\n\n  var removeFromClient = function (routes, index, route, callback) {\n    if(angular.isFunction(callback)) {\n      return SortableService.remove(routes, index, route, callback);\n    }\n    return SortableService.remove(routes, index, route);\n  };\n\n  var remove = function(routes, index, route, callback) {\n    if((angular.isUndefined(route) || route === null) && angular.isDefined(index)) {\n      route = routes[index];\n    }\n    if(angular.isUndefined(index) || index === null) {\n      index = routes.indexOf(route);\n    }\n    routes = removeFromClient(routes, index, route);\n    // if route has an id it is saved on database, if not, not\n    if(route.id) {\n      $log.debug(\"[RoutesService.remove] remove from server, too\", route);\n      var options = {\n        method: 'delete',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/routes/destroy/'+route.id, {id:route.id}, options, callback);\n    }\n  };\n\n  var find = function(query, callback) {\n    // $log.debug(\"[RoutesService.find]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/routes/find', query, options, callback);\n  };\n\n  var findOne = function(query, callback) {\n    // $log.debug(\"[RoutesService.find]\");\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/routes/findOne', query, options, callback);\n  };\n\n\n  /**\n   * For superadminsd\n   */\n  var findByHost = function(query, callback) {\n    // $log.debug(\"[RoutesService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/findByHost', query, options, callback);\n  };\n\n  /**\n   * For superadminsd\n   */\n  var exportByHost = function(host, download, callback) {\n    // $log.debug(\"[RoutesService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    \n    return JLSailsService.resolve('/Routes/exportByHost', {host: host}, options, function(err, data) {\n      $log.debug(\"[RoutesService.exportByHost]\", err, data);\n      if(err) {\n        if(download) {\n          $download(JSON.stringify(data), \"error.txt\", \"text/plain\");\n        }\n        return callback(err);\n      }\n      if(download) {\n        $download(JSON.stringify(data), \"routes.json\", \"text/json\");\n      }\n      return callback(err, data);\n    });\n  };\n\n  /**\n   * Update or create route (eg. position) for current host.\n   */\n  var updateOrCreate = function(route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreate]\", route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreate', {route: route}, options, callback);\n  };\n\n  /**\n   * Update or create route for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateByHostByObjectNameAndNavbar = function(host, route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateByHostByObjectNameAndNavbar]\", host, route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateByHostByObjectNameAndNavbar', {host: host, route: route}, options, callback);\n  };\n\n  /**\n   * Update or create route (eg. position) for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateByHost = function(host, route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateByHost]\", host, route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateByHost', {host: host, route: route}, options, callback);\n  };\n\n  /**\n   * Update or create each route (eg. position) for current host.\n   */\n  var updateOrCreateEach = function(routes, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateEach]\", routes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateEach', {routes: routes}, options, callback);\n  };\n\n  /**\n   * Update or create each route (eg. position) for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateEachByHost = function(host, routes, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateEachByHost]\", host, routes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateEachByHost', {host: host, routes: routes}, options, callback);\n  };\n\n  var generateObjectnameFromStatename = function (statename) {\n    $log.debug(\"[RoutesController.generateObjectnameFromStatename]\", statename);\n    var objectname = \"\";\n    var keys = statename.split('.');\n    for (var k = 0; k < keys.length; k++) {\n      objectname += UtilityService.capitalizeFirstLetter(keys[k]);\n    }\n    objectname = UtilityService.lowercaseFirstLetter(objectname);\n    return objectname;\n  };\n\n  var generateObjectnameFromUrl = function (url) {\n    var objectname = \"\";\n    var keys = url.split('/');\n    for (var k = 0; k < keys.length; k++) {\n      objectname += UtilityService.capitalizeFirstLetter(keys[k]);\n    }\n    objectname = UtilityService.lowercaseFirstLetter(objectname);\n    $log.debug(\"[RoutesController.generateObjectnameFromUrl]\", url, keys, objectname, objectname.length);\n    return objectname;\n  };\n\n  return {\n    create: create,\n    append: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    destroy: remove, // Alias\n    find: find,\n    findOne: findOne,\n    findByHost: findByHost,\n    exportByHost: exportByHost,\n    updateOrCreate: updateOrCreate,\n    updateOrCreateByHostByObjectNameAndNavbar: updateOrCreateByHostByObjectNameAndNavbar,\n    updateOrCreateByHost: updateOrCreateByHost,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    saveEachByHost: updateOrCreateEachByHost, // Alias\n    generateObjectnameFromStatename: generateObjectnameFromStatename,\n    generateObjectnameFromUrl: generateObjectnameFromUrl,\n  };\n});","angular.module('jumplink.cms.session', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('SessionService', function ($rootScope, JLSailsService, $sailsSocket, $q, $log) {\n\n  var create = function(user, callback) {\n    $log.debug(\"[SessionService.create]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/create', user, options, callback);\n  };\n\n  var destroy = function(user, callback) {\n    $log.debug(\"[SessionService.destroy]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/destroy', user, options, callback);\n  };\n\n  /**\n   * Check if user is authentication in current cms session\n   * Used if you need authentication conditions\n   */\n  var isAuthenticated = function (callback) {\n    $log.log(\"[SessionService.isauthenticated]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/authenticated').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in, throws an error message if your are not authenticated\n   */\n  var needToBeAuthenticated = function () {\n    $log.log(\"[SessionService.needToBeAuthenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/authenticated').then (function (data) {\n      if (data.data) {\n        $log.log(\"is authenticated\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not authenticated\", data);\n        return deferred.reject('You need to be logged in');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Check if authentifcated user is blogger or better\n   */\n  var bloggerOrBetter = function (callback) {\n    $log.log(\"[SessionService.bloggerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/bloggerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if cms is in developer mode or session user is better than that\n   */\n  var developerOrBetter = function (callback) {\n    $log.log(\"[SessionService.developerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/developerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is siteadmin or better\n   */\n  var siteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.siteadminOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is superadmin\n   */\n  var superadmin = function (callback) {\n    $log.log(\"[SessionService.superadmin]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/superadmin').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee\n   */\n  var employee = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employee').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee or better\n   */\n  var employeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user employee or better, throws an error message if your are not employee or better\n   */\n  var needToBeEmployeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is employeeOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an employee or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user is admin or better, throws an error message if your are not employee or better\n   */\n  var needToBeSiteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is siteadminOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an admin or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n  /**\n   * \n   */\n  var getAllPolicies = function (callback) {\n    $log.log(\"[SessionService.getAllPolicies]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getAllPolicies').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Get logged in user\n   */\n  var getUser = function (callback) {\n    $log.log(\"[SessionService.getUser]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getUser').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  return {\n    create: create,\n    destroy: destroy,\n    authenticated: needToBeAuthenticated, //alias TODO remove\n    needToBeAuthenticated: needToBeAuthenticated,\n    isAuthenticated: isAuthenticated, // TODO rename to authenticated\n    bloggerOrBetter: bloggerOrBetter,\n    developerOrBetter: developerOrBetter,\n    siteadminOrBetter: siteadminOrBetter,\n    superadmin: superadmin,\n    employee: employee,\n    employeeOrBetter: employeeOrBetter,\n    needToBeEmployeeOrBetter: needToBeEmployeeOrBetter,\n    needToBeSiteadminOrBetter: needToBeSiteadminOrBetter,\n    getAllPolicies: getAllPolicies,\n    getUser: getUser\n  };\n});","angular.module('jumplink.cms.sidebar', [\n    'mgcrea.ngStrap.aside',\n  ])\n\n  .directive('jlSidebar', function ($compile, $window) {\n\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      templateUrl: '/views/modern/sidebar.jade',\n      scope: {\n        routes: \"=\",\n        title: \"=\" \n      },\n      link: function ($scope, $element, $attrs) {\n        \n      }\n    };\n  });","angular.module('jumplink.cms.bootstrap.signin', [\n    'mgcrea.ngStrap',\n    'jumplink.cms.signin'\n  ])\n\n  .service('SigninBootstrapService', function ($rootScope, SigninService, $log, $modal) {\n    var siginWithModal = function(title, goBackAfterSignin, extendRoles, scope, callback) {\n      $log.debug(\"[SigninBootstrapService.siginWithModal]\", title, goBackAfterSignin, extendRoles);\n\n      if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n        callback = goBackAfterSignin;\n        goBackAfterSignin = false;\n      }\n\n      if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n        callback = extendRoles;\n        extendRoles = false;\n      }\n\n      if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n        callback = scope;\n        scope = null;\n      }\n\n      var signinModal = $modal({title: title, templateUrl: '/views/modern/signin.bootstrap.modal.jade', show: false});\n      signinModal.$scope.aborted = false;\n      signinModal.$scope.result = null;\n      signinModal.$scope.user = {\n        email: \"\",\n        password: \"\"\n      };\n      // signinModal.$scope.goBackAfterSignin = goBackAfterSignin === true;\n\n      signinModal.$scope.abort = function (user) {\n        signinModal.$scope.aborted = true;\n      };\n\n      signinModal.$scope.signin = function (user) {\n        $log.debug(\"[SigninBootstrapService.siginWithModal.signin]\", user);\n        SigninService.signin(user, goBackAfterSignin, extendRoles, scope, function (error, result) {\n          if(error) {\n            signinModal.$scope.error = error;\n            return signinModal.$scope.error;\n          }\n          signinModal.$scope.result = result;\n          // $rootScope.\n          $log.debug(result);\n        });\n      };\n\n      signinModal.$scope.$on('modal.hide',function(){\n        $log.debug(\"signin modal closed\");\n        if(angular.isFunction(callback)) {\n          callback(signinModal.$scope.error, signinModal.$scope.result, signinModal.$scope.user);\n        }\n      });\n\n      signinModal.$promise.then(signinModal.show);\n    };\n\n    return {\n      siginWithModal: siginWithModal\n    };\n  })\n;","angular.module('jumplink.cms.signin', [\n  'jumplink.cms.session',\n  'jumplink.cms.history',\n  'ngAsync'\n])\n.service('SigninService', function (SessionService, $log, HistoryService, $async) {\n\n\n  var getRoles = function (scope, callback) {\n    $async.parallel({\n      authenticated: function(callback) {\n        SessionService.isAuthenticated(callback);\n      },\n      bloggerOrBetter: function(callback) {\n        SessionService.bloggerOrBetter(callback);\n      },\n      siteadminOrBetter: function(callback) {\n        SessionService.siteadminOrBetter(callback);\n      },\n      employeeOrBetter: function(callback) {\n        SessionService.employeeOrBetter(callback);\n      }\n    },\n    callback);\n  };\n\n  var signin = function (user, goBackAfterSignin, extendRoles, scope, callback) {\n    if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n      callback = goBackAfterSignin;\n      goBackAfterSignin = false;\n    }\n\n    if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n      callback = extendRoles;\n      extendRoles = false;\n    }\n\n    if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n      callback = scope;\n      scope = null;\n    }\n\n    $log.debug(\"[SigninService.signin]\", user);\n    // $scope.user.role = 'superadmin';\n    SessionService.create(user, function (err, result) {\n      if(err) {\n        return callback(err);\n      }\n      if(!result.authenticated) {\n        return null;\n      }\n      if(extendRoles === true) {\n        SessionService.getAllPolicies(function (err, results) {\n          if(err) {\n            return callback(err);\n          }\n          $log.debug(\"scope before extend\", scope);\n          angular.extend(scope, results);\n          $log.debug(\"scope after extend\", scope);\n          if(goBackAfterSignin === true) {\n            HistoryService.back();\n          }\n        });\n      }\n      if(goBackAfterSignin === true) {\n        HistoryService.back();\n      }\n\n      $log.debug(\"[SigninService.signin]\", user);\n      $log.debug(\"[SigninService.signin] err result\", err, result);\n      return callback(null, result);\n    });\n  };\n  return {\n    signin: signin\n  };\n});","angular.module('jumplink.cms.sails', [\n    'sails.io',\n  ])\n\n  .service('JLSailsService', function ($rootScope, $sailsSocket, $q, $log) {\n\n    var resolve = function(url, query, options, callback, next) {\n      var deferred = $q.defer();\n      var errors = [\n        \"On trying to resolve \"+url,\n        \"Request has more than one results\",\n        \"No result\"\n      ];\n      if(angular.isUndefined(options)) {\n        options = {};\n      }\n      if(angular.isUndefined(options.method)) {\n        options.method = 'get';\n      }\n      if(angular.isUndefined(options.resultIsArray)) {\n        options.resultIsArray = false;\n      }\n      if(angular.isUndefined(query)) {\n        query = {};\n      }\n      // $log.debug(\"[JLSailsService.resolve]\", url, query, options);\n      $sailsSocket[options.method](url, query).then (function (data) {\n        if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n          if(angular.isFunction(callback)) {\n            return callback(null, null);\n          }\n          return deferred.resolve(null);\n        }\n        if (!options.resultIsArray && angular.isArray(data.data)) {\n          data.data = data.data[0];\n          $log.warn(errors[1]);\n        }\n        // data.data.content = html_beautify(data.data.content);\n        if(next) {\n          data.data = next(data.data);\n        }\n        if(angular.isFunction(callback)) {\n          callback(null, data.data);\n        }\n        return deferred.resolve(data.data);\n      }, function error (resp){\n        $log.error(errors[0], resp);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0], resp);\n        }\n        return deferred.reject(errors[0]);\n      });\n      return deferred.promise;\n    };\n    return {\n      resolve: resolve,\n    };\n  })\n;","angular.module('jumplink.cms.sortable', [\n    'jumplink.cms.utilities'\n  ])\n  .service('SortableService', function (UtilityService, $log, $filter) {\n    var resetPosition = function (array) {\n      for (var i = array.length - 1; i >= 0; i--) {\n        array[i].position = i+1;\n      }\n      return array;\n    };\n\n    var sort = function(objects) {\n      return $filter('orderBy')(objects, 'position');\n    };\n\n    /*\n     * Swap two elements within the object array (called objects) and adjust the position\n     */\n    var swap = function(objects, index_1, index_2, cb) {\n\n      var object_1 = objects[index_1];\n      var object_2 = objects[index_2];\n\n      // swap position too\n      var position_tmp = object_1.position;\n      object_1.position = object_2.position;\n      object_2.position = position_tmp;\n\n      // IMPORTANT: swap Indexes, too\n      objects[index_1] = object_2;\n      objects[index_2] = object_1;\n\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * Insert new object to position and move the underlying objects one index back\n     * http://stackoverflow.com/questions/5306680/move-an-array-element-from-one-array-position-to-another\n     */\n    var move = function (array, old_index, new_index, cb) {\n      $log.debug(\"[SortableService] move\");\n\n      if (new_index >= array.length) {\n          var k = new_index - array.length;\n          while ((k--) + 1) {\n              array.push(undefined);\n          }\n      }\n      array.splice(new_index, 0, array.splice(old_index, 1)[0]);\n\n      array = resetPosition(array);\n\n      if(angular.isFunction(cb)) {\n        cb(null, array);\n      }\n      return array;\n    };\n\n    /*\n     * Append a new object to array, check unique key value if set\n     */\n    var append = function(objects, data, cb, unique, uniqueKey) {\n      $log.debug(\"[SortableService.append] data\", data);\n      var errors = [\n        \"Unique key '\"+uniqueKey+\"' already exist\"\n      ];\n      var new_index = objects.length;\n      var new_position = 1;\n      var new_object;\n      var uniqueIndex = -1;\n\n      var okay = function (new_object, objects, new_index, cb) {\n        // $log.debug(\"old objects\", objects);\n        objects.push(new_object);\n        // $log.debug(\"new objects\", objects);\n        if(angular.isFunction(cb)) {\n          return cb(null, objects, new_index);\n        }\n        return objects;\n      };\n\n      var error = function (error, objects, uniqueIndex, cb) {\n        if(angular.isFunction(cb)) {\n          return cb(error, objects, uniqueIndex);\n        }\n        return error;\n      };\n\n      if(new_index >= 1) {\n        new_position = objects[new_index-1].position+1;\n      }\n\n      new_object = {\n        position: new_position,\n      };\n\n      new_object = angular.extend(new_object, data);\n      $log.debug(\"[SortableService.append] new_object\", new_object);\n\n      if(unique && new_object[uniqueKey]) {\n        uniqueIndex = UtilityService.findKeyValue(objects, uniqueKey, new_object[uniqueKey]);\n        if(uniqueIndex > -1) {\n          return error(errors[0], objects, uniqueIndex, cb);\n        } else {\n          return okay(new_object, objects, new_index, cb);\n        }\n      } else {\n        return okay(new_object, objects, new_index, cb);\n      }\n    };\n\n    /*\n     * removed object from an array and adds it in another\n     */\n    var moveObjectToAnotherArray = function(object, index_from, array_from, array_to, cb, replaceData) {\n      var errors = [\n        \"[SortableService] Error: Function parameters not correctly set\"\n      ];\n\n      var errorParamsNotSet = function () {\n        $log.error(errors[0], object, index_from, array_from, array_to);\n        return cb(errors[0]);\n      };\n\n      if(object === null) {\n        object = array_from[index_from];\n      } else if (index_from === null) {\n        index_from = array_from.indexOf(object);\n      } else {\n        errorParamsNotSet();\n      }\n\n      if(!angular.isArray(array_from) || !angular.isArray(array_to)) {\n        errorParamsNotSet();\n      }\n\n      append(array_to, object, function (err, array_to, index_to) {\n        if(err) {\n          return cb(err);\n        }\n        remove(array_from, index_from, object, function (err, array_from) {\n          if(err) {\n            return cb(err);\n          }\n          return cb(null, {index_from: index_from, array_from: array_from, index_to:index_to, array_to: array_to });\n        });\n      }, false );\n    };\n\n    var moveForward = function(index, objects, cb) {\n      if(index + 1 < objects.length ) {\n        return swap(objects, index, index+1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move forward, index is the last element.\", objects);\n      }\n      return objects;\n    };\n\n    var moveBackward = function(index, objects, cb) {\n      if(index - 1 >= 0) {\n        return swap(objects, index, index-1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move backward, index is the first element.\", objects);\n      }\n      return objects;\n    };\n\n    var remove = function (objects, index, object, cb) {\n      if(typeof(index) === 'undefined' || index === null) {\n        index = objects.indexOf(object);\n      }\n      // $log.debug(\"remove from client\", index, object);\n      if (index > -1) {\n        objects.splice(index, 1);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /*\n     * Function for Drag and Drop functionality.\n     * Moves an moveable element with the moveFunction (e.g. to swap or insert the obkect).\n     * Usually called when the mouse button is released over an existing moveable element.\n     */\n    var dropMove = function(objects, dropObjectIndex, dragObject, event, cb, moveFunction) {\n      if(!moveFunction) {\n        moveFunction = move; // swap | move\n      }\n      var dragObjectIndex = objects.indexOf(dragObject);\n      var dropObject = objects[dropObjectIndex];\n      $log.debug(\"[SortableService] dropMove, dragObject:\", dragObject, \"dragObjectIndex\", dragObjectIndex, \"dropObject\", dropObject, \"dropObjectIndex\", dropObjectIndex);\n      return moveFunction(objects, dragObjectIndex, dropObjectIndex, cb);\n    };\n\n    return {\n      resetPosition: resetPosition,\n      sort: sort,\n      swap: swap,\n      moveObjectToAnotherArray: moveObjectToAnotherArray,\n      move: move,\n      moveForward: moveForward,\n      moveBackward: moveBackward,\n      remove: remove,\n      append: append,\n      dropMove: dropMove,\n    };\n  })\n\n;","angular.module('jumplink.cms.subnavigation', [\n  'mgcrea.ngStrap',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities'\n])\n\n.service('SubnavigationService', function ($rootScope, $window, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n\n  var editModal = null;\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Navigation bearbeiten', templateUrl: '/views/modern/editsubnavigationmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('navigation', function(msg){\n      $log.debug(\"[SubnavigationService] Navigation event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Navigation wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  // WORKAROUND wait until image is loaded to fix bs-sidebar\n  var resizeOnImagesLoaded = function () {\n    angular.element($window).imagesLoaded(function() {\n      angular.element($window).triggerHandler('resize');\n    });\n  };\n\n  var create = function(data) {\n    if(!data || !data.target) {\n      data.target = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.page) {\n      cb(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(navs, data, cb) {\n\n    data = create(data);\n\n    // $log.debug(\"[SubnavigationService] data\", data);\n\n    SortableService.append(navs, data, cb);\n  };\n\n  var swap = function(navs, index_1, index_2, cb) {\n    return SortableService.swap(contents, index_1, index_2, cb);\n  };\n\n  var moveForward = function(index, navs, cb) {\n    return SortableService.moveForward(index, navs, cb);\n  };\n\n  var moveBackward = function(index, navs, cb) {\n    return SortableService.moveBackward(index, navs, cb);\n  };\n\n  var edit = function(navs, cb) {\n    // $log.debug(\"[SubnavigationService] edit subnavigations\", navs);\n    editModal.$scope.navs = navs;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    if(angular.isDefined(editModal.$scope.navs) && editModal.$scope.navs.length > 0) {\n      var index = Number(editModal.$scope.navs.length-1);\n      // $log.debug(\"[SubnavigationService] focus last subnavigationeditname\", index);\n      focus('subnavigationeditname'+index);\n    }\n\n    editModal.$scope.$on('modal.hide',function(){\n      // $log.debug(\"[SubnavigationService] edit navigation modal closed\");\n      cb(null, editModal.$scope.navs);\n    });\n  };\n\n  var removeFromClient = function (navs, index, nav, cb) {\n    if(angular.isFunction(cb)) {\n      return SortableService.remove(navs, index, nav, cb);\n    }\n    return SortableService.remove(navs, index, nav);\n  };\n\n  var remove = function(navs, index, nav, page, cb) {\n\n    if((angular.isUndefined(nav) || nav === null) && angular.isDefined(index)) {\n      nav = navs[index];\n    }\n\n    if(angular.isUndefined(index) || index === null) {\n      index = navs.indexOf(nav);\n    }\n\n    navs = removeFromClient(navs, index, nav);\n    // if nav has an id it is saved on database, if not, not\n    if(nav.id) {\n      $log.debug(\"[SubnavigationService] remove from server, too\" ,nav);\n      $sailsSocket.delete('/navigation/'+nav.id+\"?page=\"+page, {id:nav.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(cb)) {\n          return cb(null, navs);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(cb)) {\n          return cb(data);\n        }\n      });\n    }\n  };\n\n  var removeByTarget = function (navs, target, page, cb) {\n    $log.debug(\"[SubnavigationService] remove subnavigation by target \"+target);\n    var index = UtilityService.findKeyValue(navs, 'target', target);\n    if(index > -1) {\n      $log.debug(\"[SubnavigationService] subnavigation found \"+index);\n      remove(navs, index, null, page, cb);\n    } else {\n      if(angular.isFunction(cb)) {\n        cb(\"Subnavigation not found\");\n      }\n    }\n  };\n\n  var fix = function(fixed, object, index, cb) {\n    if(angular.isDefined(object.name) && angular.isString(object.name) && object.name !== \"\") {\n      fixed.push(object);\n    } else {\n      $log.warn(\"Name not set, remove Subnavigation\");\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var fixEach = function(objects, cb) {\n    var fixed = [];\n    for (var i = objects.length - 1; i >= 0; i--) {\n      fixed = fix(fixed, objects[i], i);\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var save = function(navs, page, cb) {\n    fixEach(navs, function(err, navs) {\n      $sailsSocket.put('/navigation/replaceall', {navs: navs, page: page}).success(function(data, status, headers, config) {\n        if(data !== null && typeof(data) !== \"undefined\") {\n          // WORKAROUND until socket event works\n          navs = $filter('orderBy')(data, 'position');\n          if(angular.isFunction(cb)) {\n            cb(null, navs);\n          }\n        } else {\n          var err = 'Navigation konnte nicht gespeichert werden';\n          $rootScope.pop('error', err, \"\");\n          if(angular.isFunction(cb)) {\n            cb(err, navs);\n          } \n        }\n      });\n    });\n  };\n\n  var resolve = function(page) {\n    var statename = 'layout.gallery';\n    return $sailsSocket.get('/navigation?page='+page, {page: page}).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(\"Warn: On trying to resolve \"+page+\" navs!\", \"Not found, navigation is empty!\");\n        return null;\n      }\n      data.data = $filter('orderBy')(data.data, 'position');\n      $log.debug(\"[SubnavigationService]\", data);\n      return data.data;\n    }, function error (resp){\n      $log.error(\"[SubnavigationService] Error: On trying to resolve \"+page+\" navs!\", resp);\n    });\n  };\n\n  return {\n    resizeOnImagesLoaded: resizeOnImagesLoaded,\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    create: create,\n    append: append,\n    add: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    removeByTarget: removeByTarget,\n    save: save,\n    resolve: resolve\n  };\n})\n\n.directive('jlSubnavigation', function ($compile, $window, SubnavigationService, HistoryService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/subnavigation.bootstrap.jade',\n    scope: {\n      authenticated : \"=\",\n      navs: \"=\",\n      afterSave: \"=?\",\n      afterRemove: \"=?\",\n      afterEdit: \"=?\",\n      afterAdd: \"=?\",\n      logger: \"=\",\n      page: \"=?\"\n\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, ContentService, $log, $state) {\n\n      SubnavigationService.setEditModal($scope);\n      $scope.goTo = HistoryService.goToHashPosition;\n      SubnavigationService.subscribe();\n      // SubnavigationService.resizeOnImagesLoaded();\n\n      if(angular.isUndefined($scope.page)) {\n        $scope.page = $state.current.name;\n      }\n\n      if(angular.isUndefined($scope.afterSave)) {\n        $scope.afterSave = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Navigation gespeichert!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterRemove)) {\n        $scope.afterRemove = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht entfernt!\", err);\n          }\n          $scope.logger('success', \"Navigation entfernt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterEdit)) {\n        $scope.afterEdit = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht bearbeitet!\", err);\n          }\n          $scope.logger('success', \"Navigation bearbeitet!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterAdd)) {\n        $scope.afterAdd = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht hinzugefügt!\", err);\n          }\n          $scope.logger('success', \"Navigation hinzugefügt!\", result.title);\n        };\n      }\n\n      $scope.add = function() {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.add($scope.navs, {page:page}, $scope.afterAdd);\n      };\n      $scope.addNav = $scope.add; // alias\n\n      $scope.moveForward = function(index, nav) {\n        SortableService.moveForward(index, $scope.navs, function(err, navs) {\n          if(err) {\n            $log.error(\"Error: On move subnavigation forward!\", err);\n            return err;\n          }\n          $scope.navs = navs;\n        });\n      };\n      $scope.moveForwardNav = $scope.moveForward; // alias\n\n      $scope.moveBackward = function(index, nav) {\n        SortableService.moveBackward(index, $scope.navs, function(err, navs) {\n          if(err) {\n            $log.error(\"Error: On move content backward!\", err);\n            return err;\n          }\n          $scope.navs = navs;\n        });\n      };\n      $scope.moveBackwardNav = $scope.moveBackward; // alias\n\n      $scope.edit = function(navs) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.edit(navs, $scope.afterEdit);\n      };\n      $scope.editNavs = $scope.edit; // alias\n\n      $scope.remove = function(index, nav) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.remove($scope.navs, index, nav, page, $scope.afterRemove);\n      };\n      $scope.removeNav = remove; // alias\n\n      $scope.save = function () {\n        SubnavigationService.save($scope.navs, page, $scope.afterSave);\n      };\n\n\n      // TODO move to own drag and drops sortable navigation directive \n      $scope.onDragOnComplete = function(index, nav, evt) {\n        if(nav === null) {\n          $log.debug(\"*click*\", index);\n        }\n        $log.debug(\"onDragOnComplete, nav:\", nav, \"index\", index);\n      };\n      $scope.onDragOnNavComplete = $scope.onDragOnComplete; // alias\n\n      $scope.onDropOnComplete = function(dropnavindex, dragnav, event) {\n        SortableService.dropMove($scope.navs, dropnavindex, dragnav, event, function(err, navs) {\n          $scope.navs = navs;\n        });\n      };\n      $scope.onDropOnNavComplete = $scope.onDropOnComplete; // alias\n\n      $scope.onDropOnAreaComplete = function(nav, evt) {\n        var index = $scope.navs.indexOf(nav);\n      };\n\n    }\n  };\n});","angular.module('jumplink.cms.theme', [\n  'sails.io',\n  'ngAsync',\n  'jumplink.cms.sails',\n])\n\n.service('ThemeService', function ($rootScope, $sailsSocket, $log, $async, JLSailsService) {\n  var isSubscribed = false;\n\n  /**\n   * find themes for current host from database and isert priority from database (or from local.json if no priority is set).\n   * @see CMS.ThemesController.find\n   */\n  var find = function(query, callback) {\n    $log.debug(\"[ThemeService.find]\", query);\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/find', query, options, callback);\n  };\n\n  /**\n   * find themes for any host from database and isert priority from database (or from local.json if no priority is set).\n   * Only for superadmins!\n   */\n  var findByHost = function(host, callback) {\n    // $log.debug(\"[ThemeService.findByHost]\", host);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/findbyhost', {host: host}, options, callback);\n  };\n\n  var save = function (themes, callback) {\n    updateOrCreateEach(themes, function (err, result) {\n      if(angular.isDefined(callback)) {\n        callback(err, result);\n      }\n    });\n  };\n  \n  var updateOrCreateEach = function(themes, callback) {\n    $log.debug(\"[ThemeService.updateOrCreateEach]\", themes);\n    // $sailsSocket.put('/Theme/updateOrCreateEach', {themes: themes}).success(function(data, status, headers, config) {\n    //   $log.debug(data, status, headers, config);\n    //   callback(data, status, headers, config)\n    // });\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEach', {themes: themes}, options, callback);\n  };\n\n  var updateOrCreateEachByHost = function(host, themes, callback) {\n    // $log.debug(\"[ThemeService.updateOrCreateEachByHost]\", host, themes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEachByHost', {host: host, themes: themes}, options, callback);\n  };\n\n  // TODO\n  var subscribe = function () {\n    if(!isSubscribed) {\n      $sailsSocket.subscribe('theme', function(msg){\n        if($rootScope.authenticated) {\n          $log.debug(msg);\n        }\n        switch(msg.verb) {\n          case 'updated':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurdne aktualisiert', msg.data);\n            }\n          break;\n          case 'created':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden erstellt', msg.data);\n            }\n          break;\n          case 'removedFrom':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden entfernt', \"\");\n            }\n          break;\n          case 'destroyed':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden gelöscht', \"\");\n            }\n          break;\n          case 'addedTo':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden hinzugefügt', \"\");\n            }\n          break;\n        }\n      });\n      isSubscribed = true;\n    }\n  };\n\n  return {\n    find: find,\n    findByHost: findByHost,\n    save: save,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    subscribe: subscribe\n  };\n});","angular.module('jumplink.cms.toolbar', [\n  'FBAngular'\n])\n.directive('jlToolbar', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/toolbar.jade',\n    scope: {\n      routes: \"=\",\n      title: \"=\",\n      shorttitle: \"=\",\n      fluid: \"=\",\n      position: \"=\",\n      filter: \"=\",\n      subnavigation: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n\n    },\n    controller: function ($scope, $log, Fullscreen) {\n      $scope.fullscreenIsSupported = Fullscreen.isSupported();\n      $scope.isFullscreen = false;\n      $log.debug(\"[jumplink.cms.toolbar.jlToolbar.controller]\", $scope);\n      Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n        $scope.isFullscreen = isFullscreenEnabled === true;\n        // $scope.$apply();\n      });\n\n      $scope.toggleFullscreen = function () {\n        if (Fullscreen.isEnabled()) {\n          Fullscreen.cancel();\n        } else {\n          Fullscreen.all();\n        }\n      };\n    }\n  };\n});","angular.module('jumplink.cms.bootstrap.uploader', [\n  'angularFileUpload',\n])\n.directive('jlUploader', function () {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/uploader.bootstrap.jade',\n    scope: {\n      label : \"@\",\n      labelFiles : \"@\",\n      uploadOptions: \"=\",\n      fileOptions: \"=\",\n      onCompleteAll: \"=\",\n      onCompleteItem: \"=\",\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, $log, FileUploader) {\n      $scope.files = [];\n      if(angular.isUndefined($scope.fileOptions)) {\n        $scope.fileOptions = {};\n      }\n      $scope.uploader = new FileUploader($scope.uploadOptions);\n      $log.debug(\"[jlUploader] uploadOptions\", $scope.uploadOptions);\n      $log.debug(\"[jlUploader] uploader\", $scope.uploader);\n      $log.debug(\"[jlUploader] onCompleteAll\", $scope.onCompleteAll);\n      $log.debug(\"[jlUploader] onCompleteItem\", $scope.onCompleteItem);\n\n      $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n        $log.debug(\"[jlUploader.onCompleteItem] status\", status);\n        for (var i = 0; i < response.files.length; i++) {\n          $log.debug(\"[jlUploader.onCompleteItem] response.files[i]\", response.files[i]);\n        }\n        $scope.files = $scope.files.concat(response.files);\n        if(angular.isFunction($scope.onCompleteItem)) {\n          $scope.onCompleteItem(null, $scope.files); // TODO detect error\n        }\n      };\n      \n      $scope.uploader.onCompleteAll = function() {\n        $log.debug(\"[jlUploader.onCompleteAll]\");\n        if(angular.isFunction($scope.onCompleteAll)) {\n          $scope.onCompleteAll(null, $scope.files);\n        }\n      };\n\n      $scope.upload = function(fileItem) {\n        fileItem.upload();\n      };\n\n      $scope.uploader.onProgressItem = function(fileItem, progress) {\n        $log.debug('[jlUploader.onProgressItem]', fileItem, progress);\n      };\n      \n\n    }\n  };\n});","angular.module('jumplink.cms.user', [\n    'sails.io',\n    'jumplink.cms.sails',\n  ])\n\n  .service('UserService', function ($rootScope, $sailsSocket, $log, JLSailsService) {\n    var isSubscribed = false;\n\n    var save = function(user, callback) {\n      if(!angular.isString(user.role)) {\n        user.role = \"siteadmin\";\n      }\n      \n      // update user\n      if(angular.isDefined(user.id)) {\n        $log.debug(\"update user: sailsSocket.put('/user/\"+user.id+\"..'\");\n        $sailsSocket.put('/user/'+user.id, user).success(function(data, status, headers, config) {\n          $log.debug(data, status, headers, config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      } else {\n        // create user\n        $log.debug(\"create user: sailsSocket.post('/user..\");\n        $sailsSocket.post('/user', user).success(function(data, status, headers, config) {\n          // TODO FIXME data ist not the request result ?!\n          $log.debug(\"data\", data, \"status\", status, \"headers\", headers, \"config\", config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      }\n    };\n\n    var subscribe = function () {\n      if(!isSubscribed) {\n        $sailsSocket.subscribe('user', function(msg){\n          if($rootScope.authenticated) {\n            $log.debug(msg);\n          }\n          switch(msg.verb) {\n            case 'updated':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde aktualisiert', msg.data.name);\n              }\n            break;\n            case 'created':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde erstellt', msg.data.name);\n              }\n            break;\n            case 'removedFrom':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde entfernt', \"\");\n              }\n            break;\n            case 'destroyed':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde gelöscht', \"\");\n              }\n            break;\n            case 'addedTo':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde hinzugefügt', \"\");\n              }\n            break;\n          }\n        });\n        isSubscribed = true;\n      }\n    };\n\n    var removeFromClient = function (users, user) {\n      var index = users.indexOf(user);\n      $log.debug(\"removeFromClient\", user, index);\n      if (index > -1) {\n        users.splice(index, 1);\n      }\n    };\n\n    var remove = function(users, user) {\n      $log.debug(\"$scope.remove\", user);\n      if($rootScope.authenticated) {\n        if(users.length <= 1) {\n          $log.error('Der letzte Benutzer kann nicht gelöscht werden.');\n        } else {\n          removeFromClient(users, user);\n          if(user.id) {\n            $sailsSocket.delete('/user/'+user.id, {id:user.id}).success(function(data, status, headers, config) {\n              $log.debug(\"user delete request\", data, status, headers, config);\n            });\n          }\n        }\n      }\n    };\n\n    /**\n     * find users for any host from database and isert priority from database (or from local.json if no priority is set).\n     * Only for superadmins!\n     */\n    var findByHost = function(host, callback) {\n      // $log.debug(\"[ThemeService.findByHost]\", host);\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/user/findbyhost', {host: host}, options, callback);\n    };\n\n    var updateOrCreateByHost = function(host, user, callback) {\n      $log.debug(\"[UserService.updateOrCreateByHost]\", host, routes);\n      var options = {\n        method: 'post',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/user/updateOrCreateByHost', {host: host, user: user}, options, callback);\n    };\n\n    return {\n      save: save,\n      subscribe: subscribe,\n      remove: remove,\n      findByHost: findByHost,\n      updateOrCreateByHost: updateOrCreateByHost\n    };\n  })\n;","angular.module('jumplink.cms.utilities', [\n  ])\n  .service('UtilityService', function ($log) {\n    var invertOrder = function (array) {\n      var result = [];\n      for (var i = array.length - 1; i >= 0; i--) {\n        result.push(array[i]);\n      }\n      return result;\n    };\n\n    /**\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /**\n     * @see: http://stackoverflow.com/questions/3068534/getting-javascript-object-key-list\n     */\n    var getKeys = function (obj) {\n      var keys = [];\n      if(!angular.isObject(obj)) {\n        console.error(\"[UtilityService.getKeys] is not an Object\", obj);\n        return keys;\n      }\n      for(var k in obj) {\n        keys.push(k);\n      }\n      return keys;\n    };\n\n    /**\n     * Capitalize the first character of a string, but not change the case of any of the other letters.\n     *\n     * @see http://stackoverflow.com/questions/1026069/capitalize-the-first-letter-of-string-in-javascript\n     */\n    var capitalizeFirstLetter = function (string) {\n      return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n    };\n\n    var lowercaseFirstLetter = function (string) {\n      return string.charAt(0).toLowerCase() + string.slice(1);\n    };\n\n    return {\n      invertOrder: invertOrder,\n      findKeyValue: findKeyValue,\n      getKeys: getKeys,\n      capitalizeFirstLetter: capitalizeFirstLetter,\n      lowercaseFirstLetter: lowercaseFirstLetter,\n    };\n  });","angular.module('jumplink.cms.bootstrap.validation', [\n  'jumplink.cms.validation',\n])\n.provider('jlValidationBootstrap', function jlValidationBootstrapProvider(jlValidationProvider, $validationProvider) {\n  this.setup = function () {\n    $validationProvider.setErrorHTML(function (msg) {\n      return \"<span ng-show='form.name.$error.required' class='form-control-feedback'><i class='fa fa-exclamation-triangle'></i></span><label class=\\\"control-label has-error absolute-control-label-bottom\\\">\" + msg + \"</label>\";\n    });\n    $validationProvider.setSuccessHTML(function (msg) {\n      return \"<span class='form-control-feedback'><i class='fa fa-check'></i></span><label class=\\\"control-label has-success absolute-control-label-bottom\\\">\" + msg + \"</label>\";\n    });\n    angular.extend($validationProvider, {\n      validCallback: function (element){\n        $(element).parents('.form-group:first').removeClass('has-error').addClass('has-success');\n      },\n      invalidCallback: function (element) {\n        $(element).parents('.form-group:first').removeClass('has-success').addClass('has-error');\n      }\n    });\n  };\n  this.getLocale = jlValidationProvider.getLocale;\n  this.changeLocale = jlValidationProvider.changeLocale;\n  this.$get = function jlValidationBootstrapFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlValidationBootstrap();\n  };\n});","angular.module('jumplink.cms.validation', [\n  'validation',                               // https://github.com/huei90/angular-validation\n  'validation.rule',                          // https://github.com/huei90/angular-validation\n])\n.provider('jlValidation', function jlValidationProvider($validationProvider) {\n  this.getLocale = function () {\n    var defaultMsg = {\n      \"minlength\": $validationProvider.getDefaultMsg('minlength'),\n      \"maxlength\": $validationProvider.getDefaultMsg('maxlength'),\n      \"required\": $validationProvider.getDefaultMsg('required'),\n      \"email\": $validationProvider.getDefaultMsg('email'),\n      \"number\": $validationProvider.getDefaultMsg('number'),\n      \"url\": $validationProvider.getDefaultMsg('url'),\n    };\n    return defaultMsg;\n  };\n  this.changeLocale = function (lang) {\n    var defaultMsg = {};\n    switch(lang) {\n      case 'de':\n        defaultMsg = {\n          'minlength': {\n            error: \"Eingabe muss länger sein!\",\n            success: \"Eingabe lang genug\"\n          },\n          'maxlength': {\n            error: \"Eingabe muss kürzer sein!\",\n            success: \"Eingabe kurz genug\"\n          },\n          'required': {\n            error: \"Eine Eingabe ist erforderlich!\",\n            success: \"Okay\"\n          },\n          'email': {\n            error: \"Eingabe muss einer E-Mail entsprechen!\",\n            success: \"Eingabe ist eine E-Mail\"\n          },\n          'number': {\n            error: \"Eingabe darf nur Zahlen enthalten!\",\n            success: \"Eingabe enthält nur Zahlen\"\n          },\n          'url': {\n            error: \"Eingabe muss einer URL entsprechen!\",\n            success: \"Eingabe entspricht einer URL\"\n          },\n        };\n      break;\n      case 'en':\n      break;\n      default:\n      break;\n    }\n    switch(lang) {\n      case 'de':\n        $validationProvider.setDefaultMsg(defaultMsg);\n      break;\n      case 'en':\n        // do nothing\n      break;\n      default:\n        // do nothing\n      break;\n    }\n  };\n  this.$get = function jlValidationFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlValidation();\n  };\n});","jumplink.cms.run(function(amMoment) {\n  amMoment.changeLocale('de');\n});\n","jumplink.cms.config( function($logProvider) {\n  // see init.jade environment variable\n  $logProvider.debugEnabled(environment === 'development');\n});","jumplink.cms.config( function(jlRoutesProvider) {\n\n  var routeOptions = {};\n\n  // use the HTML5 History API\n  jlRoutesProvider.html5Mode(true);\n\n  jlRoutesProvider.state('layout', {\n    abstract: true,\n    resolve: {\n      authenticated: function (SessionService) {\n        return SessionService.isAuthenticated();\n      }\n    },\n    templateUrl: '/views/modern/layout.jade',\n    controller: 'LayoutController'\n  });\n\n  // HOME\n  routeOptions.layoutHome = {\n    resolve: {\n      navs: function(SubnavigationService) {\n        var statename = 'layout.home';\n        return SubnavigationService.resolve(statename);\n      },\n      contents: function(ContentService) {\n        var statename = 'layout.home';\n        return ContentService.resolveAll(statename, 'dynamic');\n      },\n      news: function(ContentService) {\n        var statename = 'layout.home';\n        return ContentService.resolveOne(statename, 'news', 'fix');\n      },\n      events: function(EventService) {\n        var statename = 'layout.home';\n        return EventService.resolve(statename);\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/home/content.jade',\n        controller: 'HomeContentController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    }\n  };\n\n  // members\n  routeOptions.layoutMembers = {\n    resolve: {\n      members: function($sailsSocket, $filter, $log) {\n        return $sailsSocket.get('/member').then (function (data) {\n          return $filter('orderBy')(data.data, 'position');\n        }, function error (resp){\n          $log.error(resp);\n        });\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/members/content.jade',\n        controller: 'MembersController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    }\n  };\n\n  // events timeline\n  routeOptions.layoutEvents = {\n    resolve: {\n      events: function(EventService) {\n        var statename = 'layout.timeline';\n        return EventService.resolve(statename);\n      },\n      config: function(ConfigService) {\n        var statename = 'layout.timeline';\n        return ConfigService.resolve(statename);\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/events/timeline.jade',\n        controller: 'TimelineController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    }\n  };\n\n  // gallery\n  routeOptions.layoutGallery = {\n    resolve: {\n      navs: function(SubnavigationService) {\n        var statename = 'layout.gallery';\n        return SubnavigationService.resolve(statename);\n      },\n      contents_images: function(ContentService) {\n        var statename = 'layout.gallery';\n        return ContentService.resolveAllWithImage(statename);\n      },\n      config: function(ConfigService) {\n        var statename = 'layout.gallery';\n        return ConfigService.resolve(statename);\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/gallery/content.jade',\n        controller: 'GalleryContentController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    }\n  };\n\n  // application\n  routeOptions.layoutApplication = {\n    resolve: {\n      application: function(ContentService) {\n        var statename = 'layout.application';\n        var name = 'application';\n        return ContentService.resolveOne(statename, name);\n      },\n      config: function(ConfigService) {\n        var statename = 'layout.application';\n        return ConfigService.resolve(statename);\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/application/content.jade',\n        controller: 'ApplicationController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    }\n  };\n\n  // links\n  routeOptions.layoutLinks = {\n    resolve: {\n      links: function(ContentService) {\n        var statename = 'layout.links';\n        var name = 'links';\n        return ContentService.resolveOne(statename, name);\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/links/content.jade',\n        controller: 'LinksController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    }\n  };\n\n  // imprint\n  routeOptions.layoutImprint = {\n    resolve: {\n      navs: function(SubnavigationService) {\n        var statename = 'layout.imprint';\n        return SubnavigationService.resolve(statename);\n      },\n      imprint: function(ContentService) {\n        var statename = 'layout.imprint';\n        var name = 'imprint';\n        return ContentService.resolveOne(statename, name);\n      },\n      config: function(ConfigService) {\n        var statename = 'layout.imprint';\n        return ConfigService.resolve(statename);\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/imprint/content.jade',\n        controller: 'ImprintController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'FooterController'\n      }\n    }\n  };\n\n  // administration\n  jlRoutesProvider.state('layout.admin', {\n    resolve: {\n      themeSettings: function($sailsSocket, $log) {\n        return $sailsSocket.get('/theme/find').then (function (data) {\n          // $log.log(data);\n          return data.data;\n        }, function error (resp){\n          $log.error(resp);\n        });\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/administration/settings.jade',\n        controller: 'AdminController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      },\n    }\n  });\n\n  // USERS\n  jlRoutesProvider.state('layout.users', {\n    url: '/users',\n    resolve:{\n      users: function($sailsSocket, $log) {\n        return $sailsSocket.get('/user').then (function (data) {\n          return data.data;\n        }, function error (resp){\n          $log.error(resp);\n        });\n      },\n      routes: function(RoutesService) {\n        return RoutesService.find({});\n      },\n      authenticated: function (SessionService) {\n        return SessionService.isAuthenticated();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/administration/users.jade',\n        controller: 'UsersController'\n      },\n      'toolbar' : {\n        templateUrl: '/views/modern/toolbar.jade',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'ToolbarController'\n      }\n    }\n  });\n\n  // layout.gallery-fullscreen\n  jlRoutesProvider.state('layout.gallery-fullscreen', {\n    url: '/gallery/fs/:id',\n    resolve:{\n      image: function($sailsSocket, $stateParams, $log) {\n        // $log.debug(\"$stateParams\", $stateParams);\n        return $sailsSocket.get('/gallery/'+$stateParams.id).then (function (data) {\n          // $log.debug('/gallery/'+$stateParams.id, data);\n          return data.data;\n        });\n      },\n      config: function(ConfigService) {\n        var statename = 'layout.gallery-fullscreen';\n        return ConfigService.resolve(statename);\n      }\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/gallery/fullscreen.jade',\n        controller: 'GalleryFullscreenController'\n      },\n      'toolbar' : {\n        resolve: {\n          routes: function(RoutesService) {\n            return RoutesService.find({});\n          },\n        },\n        template: '<jl-toolbar data-routes=\"routes\", data-title=\"title\", data-shorttitle=\"shorttitle\", data-position=\"position\", data-fluid=\"fluid\", data-name=\"name\", data-filter=\"filter\"></jl-toolbar>',\n        controller: 'ToolbarController'\n      }\n    }\n  });\n\n  // USER\n  jlRoutesProvider.state('layout.user', {\n    url: '/user/:index',\n    resolve: {\n      user: function($sailsSocket, $stateParams, $log) {\n        return $sailsSocket.get('/user'+'/'+$stateParams.index).then (function (data) {\n          delete data.data.password;\n          return data.data;\n        }, function error (resp){\n          $log.error(resp);\n        });\n      },\n      routes: function(RoutesService) {\n        return RoutesService.find({});\n      },\n      authenticated: function (SessionService) {\n        return SessionService.isAuthenticated();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/administration/user.jade',\n        controller: 'UserController'\n      },\n      'toolbar' : {\n        templateUrl: '/views/modern/toolbar.jade',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'ToolbarController'\n      }\n    }\n  });\n\n  // NEW USER\n  jlRoutesProvider.state('layout.new-user', {\n    url: '/new/user',\n    resolve:{\n      user: function() {\n        return {\n\n        };\n      },\n      routes: function(RoutesService) {\n        return RoutesService.find({});\n      },\n      authenticated: function (SessionService) {\n        return SessionService.isAuthenticated();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/administration/user.jade',\n        controller: 'UserController'\n      },\n      'toolbar' : {\n        templateUrl: '/views/modern/toolbar.jade',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'ToolbarController'\n      }\n    }\n  });\n\n  // CMS\n  jlRoutesProvider.state('layout.cms', {\n    url: '/cms',\n    resolve: {\n      info: function(CmsService, $log) {\n        $log.debug(\"start get cms info\");\n        return CmsService.infoUser();\n      },\n      routes: function(RoutesService) {\n        return RoutesService.find({});\n      },\n      authenticated: function (SessionService) {\n        return SessionService.isAuthenticated();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/cms/content.jade',\n        controller: 'CmsController'\n      },\n      'toolbar' : {\n        templateUrl: '/views/modern/toolbar.jade',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'ToolbarController'\n      }\n    }\n  });\n\n  // Signin\n  routeOptions.layoutSignin = {\n    resolve: {\n      routes: function(RoutesService) {\n        return RoutesService.find({});\n      },\n      authenticated: function (SessionService) {\n        return SessionService.isAuthenticated();\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/signin.jade',\n        controller: 'SigninController'\n      },\n      'toolbar' : {\n        templateUrl: '/views/modern/toolbar.jade',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'ToolbarController'\n      }\n    }\n  };\n\n  routeOptions.layoutBrowser = {\n    resolve: {\n      routes: function(RoutesService) {\n        return RoutesService.find({});\n      },\n      authenticated: function (SessionService) {\n        return SessionService.isAuthenticated();\n      },\n      force: function ($stateParams) {\n        if(angular.isString($stateParams.force)) {\n          return $stateParams.force;\n        } else {\n          return null;\n        }\n      },\n    },\n    views: {\n      'content' : {\n        templateUrl: '/views/modern/browser.jade',\n        controller: 'BrowserController'\n      },\n      'toolbar' : {\n        templateUrl: '/views/modern/toolbar.jade',\n        controller: 'ToolbarController'\n      },\n      'footer' : {\n        templateUrl: '/views/modern/footer.jade',\n        controller: 'ToolbarController'\n      }\n    }\n  };\n\n  jlRoutesProvider.setRoutes(routes, routeOptions);\n});\n\njumplink.cms.run(function ($rootScope, $state, $window, $log) {\n  $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, error) {\n    $log.error(\"[config/routes.js] Error\", error);\n    $state.go('layout.signin', {error: error});\n  });\n});","jumplink.cms.run(function(amMoment) {\n  amMoment.changeLocale('de');\n});\n","jumplink.cms.controller('AdminController', function($scope, themeSettings, $log, ThemeService) {\n  $scope.themeSettings = themeSettings;\n  \n  $scope.save = function() {\n    ThemeService.save($scope.themeSettings.available, function(data) {\n      // $scope.themeSettings = data;\n      $log.debug(data);\n    });\n  };\n  \n});","jumplink.cms.controller('AppController', function($rootScope, $scope, $state, $window, $timeout, Fullscreen, toaster, $sailsSocket, $location, HistoryService, $log) {\n\n  // fix scroll to top on route change\n  $scope.$on(\"$stateChangeSuccess\", function () {\n    HistoryService.autoScroll();\n  });\n\n  //AngularJS Toaster - AngularJS Toaster is a customized version of \"toastr\" non-blocking notification javascript library: https://github.com/jirikavi/AngularJS-Toaster\n  $rootScope.pop = function(type, title, body, timeout, bodyOutputType, clickHandler) {\n    toaster.pop(type, title, body, timeout, bodyOutputType, clickHandler);\n  };\n\n  var generalSubscribes = function () {\n\n    $sailsSocket.post('/session/subscribe', {}).success(function(data, status, headers, config){\n\n      // react to subscripe from server: http://sailsjs.org/#/documentation/reference/websockets/sails.io.js/io.socket.on.html\n      $sailsSocket.subscribe('connect', function(msg){\n        $log.debug('socket.io is connected');\n      });\n\n      $sailsSocket.subscribe('disconnect', function(msg){\n        $rootScope.pop('error', 'Verbindung zum Server verloren', \"\");\n        $rootScope.authenticated = false;\n      });\n\n      $sailsSocket.subscribe('reconnect', function(msg){\n        $rootScope.pop('info', 'Sie sind wieder mit dem Server verbunden', \"\");\n      });\n\n    });\n  };\n\n  var adminSubscribes = function() {\n    // subscripe on server\n    $sailsSocket.post('/session/subscribe', {}).success(function(data, status, headers, config){\n\n      // called on any sended email from server\n      $sailsSocket.subscribe('email', function(email){\n\n        var body = ''+\n          '<dl>'+\n            '<dt>Absender</dt>'+\n            '<dd><a href=\"mailto:'+email.from+'\">'+email.from+'</a></dd>'+\n            '<dt>Betreff</dt>'+\n            '<dd>'+email.subject+'</dd>';\n            if(email.attachments) {\n              body += ''+\n              '<dt>Anhänge</dt>'+\n              '<dd>'+email.attachments.length+'</dd>';\n            }\n            body += ''+\n          '</dl>';\n\n        $rootScope.pop('info', 'Eine E-Mail wurde versendet.', body, null, 'trustedHtml');\n      });\n\n      // admin room\n      $sailsSocket.subscribe('admins', function(msg){\n        $log.debug(msg);\n      });\n\n    });\n  };\n\n  // http://stackoverflow.com/questions/18608161/angularjs-variable-set-in-ng-init-undefined-in-scope\n  $rootScope.$watch('authenticated', function () {\n    // $log.debug(\"authenticated: \"+$rootScope.authenticated);\n    if($rootScope.authenticated) {\n      $rootScope.mainStyle = {'padding-bottom':'50px'};\n      $rootScope.toasterPositionClass = 'toast-bottom-right-with-toolbar';\n      adminSubscribes();\n    } else {\n      $rootScope.mainStyle = {'padding-bottom':'0px'};\n      $rootScope.toasterPositionClass = 'toast-bottom-right';\n    }\n  });\n  generalSubscribes();\n\n  // TODO loading animation on $stateChangeStart\n    $rootScope.$on('$stateChangeStart',\n  function(event, toState, toParams, fromState, fromParams){\n    // $rootScope.loadclass = 'loading'; // WORKAROUND comment because event is not always fired, see FIXME\n  });\n\n  // on new url\n  $rootScope.$on('$stateChangeSuccess',\n  function(event, toState, toParams, fromState, fromParams){\n    $rootScope.loadclass = 'finish'; // FIXME this event is not always fired\n    switch(toState.name) {\n      case \"layout.home\":\n        $rootScope.bodyclass = 'home';\n      break;\n      case \"layout.gallery\":\n        $rootScope.bodyclass = 'gallery';\n      break;\n      case \"layout.gallery-slider\":\n        $rootScope.bodyclass = 'gallery-slider';\n      break;\n      default:\n        $rootScope.bodyclass = toState.name;\n      break;\n    }\n  });\n\n  $rootScope.getWindowDimensions = function () {\n    return { 'height': angular.element($window).height(), 'width': angular.element($window).width() };\n  };\n\n  angular.element($window).bind('resize', function () {\n    // $timeout(function(){\n    //   $rootScope.$apply();\n    // });\n    // $rootScope.$apply();\n  });\n\n  // http://stackoverflow.com/questions/641857/javascript-window-resize-event\n  if(angular.element($window).onresize) { // if jQuery is used\n    angular.element($window).onresize = function(event) {\n      $timeout(function(){\n        $rootScope.$apply();\n      });\n    };\n  }\n\n  // http://stackoverflow.com/questions/22991481/window-orientationchange-event-in-angular\n  angular.element($window).bind('orientationchange', function () {\n    $timeout(function(){\n      $rootScope.$apply();\n    });\n  });\n\n  angular.element($window).bind('deviceorientation', function () {\n    $timeout(function(){\n      $rootScope.$apply();\n    });\n  });\n\n  $rootScope.$watch($rootScope.getWindowDimensions, function (newValue, oldValue) {\n    $rootScope.windowHeight = newValue.height;\n    $rootScope.windowWidth = newValue.width;\n    $timeout(function(){\n      $rootScope.$apply();\n    });\n  }, true);\n\n  $rootScope.logout = function() {\n    $sailsSocket.post(\"/session/destroy\", {}).success(function(data, status, headers, config) {\n      $rootScope.authenticated = false;\n      $rootScope.pop('success', 'Erfolgreich abgemeldet', \"\");\n    });\n  };\n\n  $scope.goToState = $state.go;\n\n});","// Aufnahmeantrag\njumplink.cms.controller('ApplicationController', function($rootScope, $scope, $sailsSocket, moment, $filter, application, config, $state, $log) {\n  var page = $state.current.name;\n  var date = moment(); // now\n  \n  $scope.html = false;\n  $scope.application = application;\n\n  $scope.member = {\n    datum: $filter('amDateFormat')(date, 'dddd, Do MMMM YYYY'),\n    name: null,\n    vorname: null,\n    geburtstag: null,\n    geburtsort: null,\n    email: null,\n    telefon: null,\n    beruf: null,\n    strasse: null,\n    plz: null,\n    ort: null,\n    bank: {\n      name: null,\n      iban: null,\n      bic: null,\n    }\n  };\n  $scope.minYearsOld = 10;\n  $scope.minBirthdayDate = moment().subtract($scope.minYearsOld, 'years');\n  // $log.debug(\"$scope.minBirthdayDate\", $scope.minBirthdayDate);\n  $scope.maxYearsOld = 100;\n  $scope.maxBirthdayDate = moment().subtract($scope.maxYearsOld, 'years');\n  // $log.debug(\"$scope.maxBirthdayDate)\", $scope.maxBirthdayDate);\n\n  $scope.upload = function() {\n\n    var cc = config.email;\n    var to = $scope.member.email;\n    var from = $scope.member.email;\n    var subject = 'Aufnahmeantrag von '+$scope.member.vorname+' '+$scope.member.name;\n    var html = ''+\n    '<dl>'+\n      '<dt>Absender</dt>'+\n      '<dd><a href=\"mailto:'+from+'\">'+from+'</a></dd>'+\n      '<dt>Betreff</dt>'+\n      '<dd>'+subject+'</dd>'+\n    '</dl>'+\n    '<br>'+\n    'Bitte drucken Sie den Aufnahmeantrag aus und schicken Sie ihn an den Nautischen Verein Cuxhaven e.V.';\n    var text = String(html).replace(/<[^>]+>/gm, '');\n    var attachmentFilename = 'aufnahmeantrag_'+$scope.member.vorname+'_'+$scope.member.name;\n    attachmentFilename = attachmentFilename.toLowerCase();\n\n    $rootScope.pop('info', 'Aufnahmeantrag wird bearbeitet');\n    $scope.webodf.refresh(function() {\n      $scope.webodf.upload(function(error, response ) {\n        if(error) $log.debug(error);\n        // $log.debug(response);\n        var odtFilename = response.files[0].uploadedAs;\n        var odtPath = response.files[0].fd;\n        $sailsSocket.put(\"/document/convert/\", {filename: odtFilename, extension: 'pdf'}).success(function(data, status, headers, config){\n          // $log.debug(data);\n           var pdfPath = data.target;\n          $sailsSocket.put(\"/document/convert/\", {filename: odtFilename, extension: 'html'}).success(function(data, status, headers, config){\n            // $log.debug(data);\n            $rootScope.pop('success', 'Aufnahmeantrag erfolgreich erzeugt');\n             var htmlPath = data.target;\n\n            $sailsSocket.post('/email/send', {from: from, to:  to+','+cc, subject: subject, text: text, html: html, attachments: [{filename: attachmentFilename+\".pdf\", path:pdfPath}, {filename: attachmentFilename+\".html\", path:htmlPath}, {filename: attachmentFilename+\".odt\", path:odtPath}]}).success(function(data, status, headers, config){\n              if(!$rootScope.authenticated) {\n                $rootScope.pop('success', 'E-Mail wurde versendet.');\n              }\n            });\n          });\n        });\n      });\n    });\n  };\n\n  $scope.download = function() {\n    $scope.webodf.refresh(function() {\n      $scope.webodf.download(\"Aufnahmeantrag.odt\");\n    });\n  };\n\n  $scope.refresh = function() {\n    $scope.webodf.refresh(function() {\n      $rootScope.pop('success', 'Aufnahmeantrag wurde aktualisiert');\n    });\n  };\n\n  var onWebODFReady = function() {\n    // $log.debug(\"ready\");\n  };\n\n  $scope.webodf = {\n    ready: onWebODFReady\n  };\n\n  // called on content changes\n  $sailsSocket.subscribe('content', function(msg){\n    $log.debug(msg);\n    switch(msg.verb) {\n      case 'updated':\n        switch(msg.id) {\n          case 'application':\n            $scope.application = msg.data;\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Aufnahmeantrags-Text wurde aktualisiert', \"\");\n            }\n          break;\n        }\n      break;\n    }\n  });\n\n  $scope.toogleHtml = function() {\n    $scope.html = !$scope.html;\n  };\n\n  $scope.save = function() {\n    $scope.application.page = page;\n    $sailsSocket.put(\"/content/replace\", $scope.application, function (response) {\n      if(response !== null && typeof(response) !== \"undefined\") {\n        $log.debug (response);\n      } else {\n        $log.debug (\"Can't save site\");\n      }\n    });\n  };\n\n});","jumplink.cms.controller('BrowserController', function($scope, $log, authenticated, force) {\n  $scope.force = force;\n});","jumplink.cms.controller('CmsController', function($rootScope, $scope, info, $location, $anchorScroll, $state, $log) {\n  var page = $state.current.name;\n  $scope.info = info;\n\n  $scope.goTo = function (hash) {\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n});","jumplink.cms.controller('FooterController', function($scope) {\n\n});","jumplink.cms.controller('GalleryContentController', function($rootScope, $scope, authenticated, $state, Fullscreen, $sailsSocket, $stateParams, contents_images, navs, config, $modal, $log, $location, SortableService, GalleryService, ContentService, SubnavigationService, HistoryService) {\n  $rootScope.authenticated = authenticated;\n  $scope.images = contents_images.images;\n  $scope.config = config;\n  $scope.contents = contents_images.contents;\n  $scope.navs = navs;\n  $scope.html = ContentService.getShowHtml();\n  $scope.dropdown = GalleryService.getDropdown();\n  $scope.goTo = HistoryService.goToHashPosition;\n\n  var page = $state.current.name;\n\n  GalleryService.setEditModal($scope);\n  var imageOptions = {\n    path: config.paths.gallery,\n    thumbnail: {\n      path: config.paths.gallery,\n      width: 300\n    },\n    rescrop: {\n      path: config.paths.gallery,\n      width: 1200,\n      cropwidth: 1200,\n      cropheight: 1200\n    }\n  };\n  GalleryService.setUploadModal($scope, $scope.images, $scope.contents, imageOptions,\n    function (uploadModal) {\n      $log.debug(\"[GalleryContentController.uploadModalSetted]\");\n    },\n    function onCompleteCallback (response, status, headers) {\n      $log.debug(\"[GalleryContentController.onCompleteCallback]\", response, status, headers);\n    }\n  );\n  GalleryService.subscribe();\n\n  ContentService.setEditModal($scope);\n  ContentService.subscribe();\n\n  SubnavigationService.setEditModal($scope);\n  SubnavigationService.subscribe();\n\n  $scope.toogleHtml = function() {\n    $scope.html = ContentService.toogleShowHtml($scope.contents);\n  };\n\n  $scope.removeContent = function(index, content) {\n    if($rootScope.authenticated) {\n      ContentService.remove($scope.contents, index, content, page, function (err, contents) {\n        if(err) {\n          $log.error(\"Error: On remove content!\", err);\n          $rootScope.pop('error', 'Inhaltsblock konnte nicht entfernt werden', \"\");\n        }\n        else{\n          // $rootScope.pop('success', 'Inhaltsblock wurde entfernt', \"\");\n          // $scope.contents = contents;\n          SubnavigationService.removeByTarget($scope.navs, content.name, page, function (err, navs) {\n            if(err) {\n              $log.error(\"Error: On remove subnavigation!\", err);\n              $rootScope.pop('error', 'Subnavigation konnte nicht entfernt werden', \"\");\n            }\n            else{\n              // $rootScope.pop('success', 'Subnavigation wurde entfernt', \"\");\n              $rootScope.pop('success', 'Erfolgreich entfernt', \"\");\n            }\n          });\n        }\n      });\n    }\n  };\n\n  $scope.removeImage = function(image) {\n    $log.debug(\"removeImage\", \"image\", image);\n    if($rootScope.authenticated) {\n      GalleryService.remove($scope.images[image.content], null, image, page, function (err, images) {\n        if(err) {\n          $log.error(\"Error: On remove content!\", err);\n          $rootScope.pop('error', 'Bild konnte nicht entfernt werden', \"\");\n        } else{\n          $rootScope.pop('success', 'Bild wurde entfernt', \"\");\n          $scope.images[content.name] = images;\n        }\n      });\n    }\n  };\n\n  $scope.removeNav = function(index, nav) {\n    if($rootScope.authenticated) {\n      SubnavigationService.remove($scope.navs, index, nav, page, function (err, navs) {\n        if(err) $log.error(\"Error: On remove subnavigation!\", err);\n        else {\n          $log.debug(\"remove done!\");\n          $scope.navs = navs;\n        }\n      });\n    }\n  };\n\n  var addImage = function() {\n    if($rootScope.authenticated) {\n      GalleryService.add($scope.images, $scope.contents, function(err) {\n        if(err) $log.error(\"Error: On image content!\", err);\n        $scope.save();\n      });\n    }\n  };\n\n  var addContent = function() {\n    var errors = [\n      \"Error: Konnte Inhaltsblock nicht erzeugen\",\n      \"Error: Konnte Inhaltsblock nicht hinzufügen\",\n      \"Error: Konnte subnavigation nicht hinzufügen\",\n      \"Error: Konnte Bilderblock nicht hinzufügen\"\n    ];\n\n    var successes = [\n      \"Neuen Inhaltsblock erfolgreich hinzugefügt\",\n      \"Neue Subnavigation erfolgreich hinzugefügt\",\n      \"Neuen Bilderblock erfolgreich hinzugefügt\",\n      \"Neuen Block erfolgreich hinzugefügt\",\n    ];\n\n    if($rootScope.authenticated) {\n      ContentService.createEdit($scope.contents, page, function(err, content) {\n        if(err) {\n          $log.error(errors[0], err);\n          $rootScope.pop('error', errors[0], err);\n          $scope.$apply();\n        } else {\n          ContentService.append($scope.contents, content, function (err, contents) {\n            if(err) {\n              $log.error(errors[1], err);\n              // $rootScope.pop('error', errors[1], err);\n              $scope.$apply();\n            } else {\n              // $scope.contents = contents;\n              // $rootScope.pop('success', successes[0], content.title);\n              $scope.$apply();\n\n              SubnavigationService.append($scope.navs, {page:page, target: content.name, name: content.title}, function(err, navs) {\n                if(err) {\n                  $log.error(errors[2], err);\n                  $rootScope.pop('error', errors[2], err);\n                } else {\n                  // $scope.navs = navs;\n                  // $rootScope.pop('success', successes[1], content.name);\n                  $scope.$apply();\n\n                  // also add an image block to content block\n                  GalleryService.addBlock($scope.images, content, function(err, imageBock) {\n                    if(err) {\n                      $log.error(errors[3], err);\n                      $rootScope.pop('error', errors[3], err);\n                    } else {\n                      $rootScope.pop('success', successes[3], content.name);\n                      $scope.$apply();\n                    }\n                  });\n                }\n              });\n            }\n          });  \n        }\n      });\n    }\n  };\n\n  $scope.addNav = function() {\n    if($rootScope.authenticated) {\n      SubnavigationService.append($scope.navs, {page:page}, function(err, navs) {\n        if(err) $log.error(\"Error: On add subnavigation!\", err);\n        // $log.debug(\"add done on subnavigation!\", '');\n      });\n    }\n  };\n\n  $scope.moveForwardContent = function(index, content) {\n    SortableService.moveForward(index, $scope.contents, function(err, contents) {\n      if(err) $log.error(\"Error: On move content forward!\", err);\n      else $scope.contents = contents;\n    });\n  };\n\n  $scope.moveForwardNav = function(index, nav) {\n    SortableService.moveForward(index, $scope.navs, function(err, navs) {\n      if(err) $log.error(\"Error: On move subnavigation forward!\", err);\n      else $scope.navs = navs;\n    });\n  };\n\n  $scope.moveBackwardContent = function(index, content) {\n    SortableService.moveBackward(index, $scope.contents, function(err, contents) {\n      if(err) $log.error(\"Error: On move content backward!\", err);\n      else $scope.contents = contents;\n    });\n  };\n\n  $scope.moveBackwardNav = function(index, nav) {\n    SortableService.moveBackward(index, $scope.navs, function(err, navs) {\n      if(err) $log.error(\"[GalleryContentController.js] Error: On move content backward!\", err);\n      else $scope.navs = navs;\n    });\n  };\n\n  $scope.editImage = GalleryService.edit;\n\n  $scope.editContent = function(index, content) {\n    if($rootScope.authenticated) {\n      ContentService.edit(content, function(err, newContent) {\n        if(err) $log.error(\"[GalleryContentController.js] Error: On edit content!\", err);\n        else {\n          content = newContent;\n          $scope.save();\n        }\n      });\n    }\n  };\n\n  $scope.editNavs = function(navs) {\n    if($rootScope.authenticated) {\n      SubnavigationService.edit(navs, function(err) {\n        if(err) $log.error(\"[GalleryContentController.js] Error: On edit subnavigations!\", err);\n      });\n    }\n  };\n\n  $scope.saveImage = function(image) {\n    if($rootScope.authenticated) {\n      if(angular.isDefined(image)) {  \n        GalleryService.saveOne(image, page, image.name, function (err, image) {\n          if(err) {\n            $log.error (err, image);\n            $rootScope.pop('error', err, image);\n          } else {\n            $rootScope.pop('success', 'Bild wurde aktualisiert', '');\n          }\n        });\n      }\n    }\n  };\n\n\n  $scope.save = function() {\n    if($rootScope.authenticated) {\n      GalleryService.saveAllBlocks($scope.images, page, function (err, images) {\n        if(err) {\n          $log.error (err, images);\n          $rootScope.pop('error', err, images);\n        } else {\n          $log.debug (\"Bilder wurden aktualisiert\", images);\n          // $rootScope.pop('success', 'Bilder wurden auf dem Server gespeichert', '');\n          ContentService.save($scope.contents, page, function(err, contents) {\n            if(err) {\n              $log.error(\"Error: On save content!\", err);\n              if(cb) return cb(err);\n              return err;\n            } else {\n              $log.debug ('Contentblocks wurden aktualisiert', contents);\n              // $rootScope.pop('success', 'Contentblocks wurden auf dem Server gespeichert', '');\n              SubnavigationService.save($scope.navs, page, function(err, navs) {\n                if(err) {\n                  $log.error(\"Error: On save subnavigations!\", err);\n                  if(cb) return cb(err);\n                  return err;\n                } else {\n                  $log.debug ('Subnavigation wurde aktualisiert', contents);\n                  // $rootScope.pop('success', 'Subnavigation wurde auf dem Server gespeichert', '');\n                  $rootScope.pop('success', 'Galerie wurde gespeichert', '');\n                }\n              });\n            }\n          });\n        }\n      });\n    }\n  };\n\n  // http://stackoverflow.com/questions/21702375/angularjs-ng-click-over-ng-click\n  $scope.stopPropagation = function (event) {\n     event.stopPropagation();\n  };\n\n  $scope.goToImage = function (image) {\n    $state.go('layout.gallery-fullscreen', {id:image.id});\n  };\n\n  /* ==== Drag and Drop Stuff ==== */\n  $scope.onDragOnImageComplete = function(index, image, evt, content) {\n    if(image === null) {\n      $log.debug(\"*click*\", index);\n      image = $scope.images[content.name][index];\n      $scope.goToImage(image);\n    }\n  };\n\n  $scope.onDropOnImageComplete = function(dropimageindex, dragimage, evt, content) {\n\n\n    SortableService.dropMove($scope.images[content.name], dropimageindex, dragimage, evt, function(err, images) {\n      $scope.images[content.name] = images;\n      $scope.save();\n    }, SortableService.move);\n  };\n\n  $scope.onDropOnAreaComplete = function(image, evt, content) {\n    $log.debug(\"onDropOnAreaComplete\");\n    // $log.debug(\"images\", $scope.images);\n    // $log.debug(\"content\", content);\n\n    // var index = $scope.images[content.name].indexOf(image);\n\n    if(image !== null && image.content != content.name) {\n      $log.debug(\"Move image from one content block to another:\\n\\t\"+image.content+\" => \"+content.name);\n      var content_from = image.content;\n      var content_to = content.name;\n      SortableService.moveObjectToAnotherArray(image, null, $scope.images[content_from], $scope.images[content_to], function (err, result) {\n        if(err) $rootScope.pop('error', \"Bild konnte nicht verschoben werden\", err);\n        else {\n          result.array_to[result.index_to].content = content_to;\n          // $rootScope.pop('success', \"Bild erfolgreich verschoben\", content_from+\" => \"+content_to);\n        }\n        $scope.save();\n        $scope.$apply();\n      });\n    } else {\n      $log.debug(\"Move image within the content block:\\n\\t\"+content.name);\n    }\n\n  };\n\n  // TODO move to own drag and drops sortable navigation directive \n  $scope.onDragOnNavComplete = function(index, nav, evt) {\n    if(nav === null) {\n      $log.debug(\"*click*\", index);\n    }\n    $log.debug(\"onDragOnNavComplete, nav:\", nav, \"index\", index);\n  };\n\n  $scope.onDropOnNavComplete = function(dropnavindex, dragnav, event) {\n    SortableService.dropMove($scope.navs, dropnavindex, dragnav, event, function(err, navs) {\n      $scope.navs = navs;\n    });\n  };\n\n  $scope.onDropOnAreaComplete = function(nav, evt) {\n    var index = $scope.navs.indexOf(nav);\n    // $log.debug(\"onDropOnAreaComplete, nav:\", nav, \"index\", index);\n  };\n\n  $scope.addDropdownActions = {\n    'addImage': addImage,\n    'addContent': addContent\n  };\n\n  $scope.addDropdown = [\n    {\n      \"text\": \"<i class=\\\"fa fa-file-image-o\\\"></i>&nbsp;Bild\",\n      \"click\": \"addDropdownActions.addImage()\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-header\\\"></i>&nbsp;Überschrift\",\n      \"click\": \"addDropdownActions.addContent()\"\n    }\n  ];\n\n});","jumplink.cms.controller('GalleryFullscreenController', function($scope, image, config) {\n  $scope.image = image;\n  $scope.config = config;\n});","jumplink.cms.controller('GallerySlideController', function($scope, $sailsSocket, $stateParams, $timeout, images, $log) {\n  $scope.images = images;\n  var setSlide = function () {\n    if(typeof $stateParams.slideIndex !== 'undefined') {\n      if($scope.slideIndex !== $stateParams.slideIndex)\n        $scope.slideIndex = $stateParams.slideIndex;\n    } else {\n      if($scope.slideIndex !== 0)\n        $scope.slideIndex = 0;\n    }\n  };\n  // workaround\n  $timeout(function() {\n    setSlide();\n  }, 1000);\n});","jumplink.cms.controller('HomeContentController', function($rootScope, $scope, $window, authenticated, contents, navs, events, news, $state, $log, $modal, HistoryService, ContentService, SubnavigationService, SortableService) {\n  var page = $state.current.name;\n  $rootScope.authenticated = authenticated;\n  $scope.contents = contents;\n  $scope.news = news;\n  $scope.navs = navs; // for left navigation with affix, scrollspy and anchor\n  $scope.events = events;\n  ContentService.setEditModal($scope);\n  SubnavigationService.setEditModal($scope);\n  $scope.goTo = HistoryService.goToHashPosition;\n  $scope.html = ContentService.getShowHtml();\n  ContentService.subscribe();\n  SubnavigationService.subscribe();\n\n  // WORKAROUND wait until image is loaded to fix bs-sidebar\n  SubnavigationService.resizeOnImagesLoaded();\n\n  $scope.toogleHtml = function() {\n    $scope.html = ContentService.toogleShowHtml($scope.contents);\n  };\n\n  $scope.addContent = function() {\n    var errors = [\n      \"Error: Konnte Inhaltsblock nicht erzeugen\",\n      \"Error: Konnte Inhaltsblock nicht hinzufügen\",\n    ];\n\n    var successes = [\n      \"Neuen Inhaltsblock erfolgreich hinzugefügt\",\n      \"Neue Subnavigation erfolgreich hinzugefügt\",\n      \"Neuen Block erfolgreich hinzugefügt\",\n    ];\n\n    if($rootScope.authenticated) {\n      // generates new content and opens the modal\n      ContentService.createEdit($scope.contents, page, function(err, content) {\n        if(err) {\n          $log.error(errors[0], err);\n          $rootScope.pop('error', errors[0], err);\n          $scope.$apply();\n        } else {\n          ContentService.append($scope.contents, content, function (err, contents) {\n            if(err) {\n              $log.error(errors[1], err);\n              $rootScope.pop('error', errors[1], err);\n              $scope.$apply();\n            } else {\n              // $scope.contents = contents;\n              // $rootScope.pop('success', successes[0], content.title);\n              $scope.$apply();\n              SubnavigationService.append($scope.navs, {page:page, target: content.name, name: content.title}, function(err, navs) {\n                if(err) {\n                  $log.error(errors[2], err);\n                  $rootScope.pop('error', errors[2], err);\n                } else {\n                  // $scope.navs = navs;\n                  $rootScope.pop('success', successes[2], content.title);\n                  $scope.$apply();\n                }\n              });\n            }\n          });  \n        }\n      });\n    }\n  };\n\n  $scope.addNav = function() {\n    if($rootScope.authenticated) {\n      SubnavigationService.add($scope.navs, {page:page}, function(err, navs) {\n        if(err) $log.error(\"Error: On add navs!\", err);\n        $log.debug(\"add navs done!\", navs);\n      });\n    }\n  };\n\n  $scope.moveForward = function(index, content) {\n    SortableService.moveForward(index, $scope.contents, function(err, contents) {\n      if(err) $log.error(\"Error: On move content forward!\", err);\n      else $scope.contents = contents;\n    });\n  };\n\n  $scope.moveForwardNav = function(index, nav) {\n    SortableService.moveForward(index, $scope.navs, function(err, navs) {\n      if(err) $log.error(\"Error: On move subnavigation forward!\", err);\n      else $scope.navs = navs;\n    });\n  };\n\n  $scope.moveBackward = function(index, content) {\n    SortableService.moveBackward(index, $scope.contents, function(err, contents) {\n      if(err) $log.error(\"Error: On move content backward!\", err);\n      else $scope.contents = contents;\n    });\n  };\n\n  $scope.moveBackwardNav = function(index, nav) {\n    SortableService.moveBackward(index, $scope.navs, function(err, navs) {\n      if(err) $log.error(\"Error: On move content backward!\", err);\n      else $scope.navs = navs;\n    });\n  };\n\n  $scope.edit = function(index, content) {\n    if($rootScope.authenticated) {\n      ContentService.edit(content, function(err, content) {\n        if(err) {\n          if(err === 'discarded') $log.warn(\"Edit content \", err);\n          else $log.error(\"Error: On edit content!\", err);\n        }\n\n      });\n    }\n  };\n\n  $scope.editNavs = function(navs) {\n    if($rootScope.authenticated) {\n      SubnavigationService.edit(navs, function(err) {\n        if(err) $log.error(\"[HomeContentController.js] Error: On edit subnavigations!\", err);\n      });\n    }\n  };\n\n  $scope.remove = function(index, content) {\n    if($rootScope.authenticated) {\n      ContentService.remove($scope.contents, index, content, page, function (err, contents) {\n        if(err) {\n          $log.error(\"Error: On remove content!\", err);\n          $rootScope.pop('error', 'Inhaltsblock konnte nicht entfernt werden', \"\");\n        }\n        else{\n          $rootScope.pop('success', 'Inhaltsblock wurde entfernt', \"\");\n          // $scope.contents = contents;\n\n          SubnavigationService.removeByTarget($scope.navs, content.name, page, function (err, navs) {\n            if(err) {\n              $log.error(\"Error: On remove subnavigation!\", err);\n              $rootScope.pop('error', 'Subnavigation konnte nicht entfernt werden', \"\");\n            }\n            else{\n              $rootScope.pop('success', 'Subnavigation wurde entfernt', \"\");\n              \n            }\n          });\n\n        }\n      });\n    }\n  };\n\n  $scope.removeNav = function(index, nav) {\n    if($rootScope.authenticated) {\n      SubnavigationService.remove($scope.navs, index, nav, page, function (err, navs) {\n        if(err) $log.error(\"Error: On remove subnavigation!\", err);\n        else {\n          $log.debug(\"remove done!\");\n          $scope.navs = navs;\n        }\n      });\n    }\n  };\n\n  $scope.save = function(index, content) {\n    if($rootScope.authenticated) {\n      // Save all contents to be shure all positions are saved\n      saveAll(function(err, result) {\n        if(err) {\n          $log.error(\"Error: On save all!\", err);\n          $rootScope.pop('error', 'Seite konnte nicht gespeichert werden', err);\n        } else {\n          $rootScope.pop('success', 'Seite wurde gespeichert', \"\");\n        }\n      });\n    }\n  };\n\n  $scope.refresh = function(cb) {\n    ContentService.refresh($scope.contents, cb);\n  };\n\n  var saveAll = function(cb) {\n    if($rootScope.authenticated) {\n      $log.debug(\"Save news\");\n      ContentService.saveOne($scope.news, page, function(err, content) {\n        if(err) {\n          $log.error(\"Error: On save content!\", err);\n          if(cb) return cb(err);\n          return err;\n        }\n        $log.debug(\"Save other contents\");\n        ContentService.save($scope.contents, page, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On save content!\", err);\n            if(cb) return cb(err);\n            return err;\n          }\n          $scope.contents = contents;\n          // $rootScope.pop('success', 'Seiteninhalt wurde gespeichert', \"\");\n          $log.debug(\"Save subnavigation\");\n          SubnavigationService.save($scope.navs, page, function(err, navs) {\n            if(err) {\n              $log.error(\"Error: On save navigation!\", err);\n              if(cb) return cb(err);\n              return err;\n            }\n            $scope.navs = navs;\n            // $rootScope.pop('success', 'Navigation wurde gespeichert', \"\");\n            if(cb) cb(null, {contents:contents, navs:navs});\n          });\n        });\n      });\n    }\n  };\n\n  // TODO move to own drag and drops sortable navigation directive \n  $scope.onDragOnNavComplete = function(index, nav, evt) {\n    if(nav === null) {\n      $log.debug(\"*click*\", index);\n    }\n    $log.debug(\"onDragOnNavComplete, nav:\", nav, \"index\", index);\n  };\n\n  $scope.onDropOnNavComplete = function(dropnavindex, dragnav, event) {\n    SortableService.dropMove($scope.navs, dropnavindex, dragnav, event, function(err, navs) {\n      $scope.navs = navs;\n    });\n  };\n\n  $scope.onDropOnAreaComplete = function(nav, evt) {\n    var index = $scope.navs.indexOf(nav);\n    // $log.debug(\"onDropOnAreaComplete, nav:\", nav, \"index\", index);\n  };\n\n});","jumplink.cms.controller('ImprintController', function($rootScope, $scope, authenticated, $sailsSocket, imprint, navs, config, $location, $anchorScroll, $state, $log, ContentService) {\n  var page = $state.current.name;\n  $rootScope.authenticated = authenticated;\n  // $scope.config = config;\n  $scope.imprint = imprint;\n  $scope.navs = navs;\n\n  $scope.email = {\n    from: null,\n    name: null,\n    subject: null,\n    content: null,\n  };\n\n  // workaround\n  $rootScope.$watch('authenticated', function(newVal, oldVal) {\n    $scope.authenticated = $rootScope.authenticated;\n  });\n  \n  $scope.goTo = function (hash) {\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n  $scope.toogleHtml = function() {\n    $scope.html = !$scope.html;\n  };\n\n  $scope.save = function() {\n    $scope.imprint.name = 'imprint';\n    ContentService.saveOne($scope.imprint, page, function(err, imprint) {\n      if(err) {\n        $log.error(\"Error: On save content!\", err);\n        if(angular.isDefined(cb)) return cb(err); else return err;\n      } else {\n        $rootScope.pop('success', 'Content wurde aktualisiert', \"\");\n      }\n    });\n\n    $sailsSocket.put('/navigation/replaceall', {navs: $scope.navs, page: page}).success(function(data, status, headers, config) {\n      if(data !== null && typeof(data) !== \"undefined\") {\n        $log.debug (data);\n      } else {\n        $log.debug (\"Can't save site\");\n      }\n    });\n  };\n\n  $scope.sendMail = function() {\n\n    var cc = $scope.email.from;\n    var to = config.email;\n    var from = $scope.email.from;\n    var subject = 'Kontaktanfrage von '+$scope.email.name+': '+$scope.email.subject;\n\n    var html = ''+\n    '<dl>'+\n      '<dt>Absender</dt>'+\n      '<dd><a href=\"mailto:'+$scope.email.from+'\">'+$scope.email.from+'</a></dd>'+\n      '<dt>Betreff</dt>'+\n      '<dd>'+$scope.email.subject+'</dd>'+\n    '</dl>'+\n    '<br>'+\n    $scope.email.content;\n\n    var text = String(html).replace(/<[^>]+>/gm, '');\n\n    $sailsSocket.post('/email/send', {from: from, to: to+','+cc, subject:subject, text: text, html: html}).success(function(data, status, headers, config){\n      if(!$rootScope.authenticated) {\n        $rootScope.pop('success', 'E-Mail wurde versendet.');\n      }\n      $log.debug(data);\n    });\n  };\n\n  angular.extend($scope, {\n    nvc: {\n      lat: 53.86411893791266,\n      lng: 8.70941162109375,\n      zoom: 14\n    },\n    markers: {\n      main_marker: {\n        lat: 53.86682040225137,\n        lng: 8.706825971603394,\n        focus: true,\n        //message: \"Hey, drag me if you want\",\n        title: \"Nautischer Verein Cuxhaven e.V.\",\n        draggable: false,\n        label: {\n          message: \"<a target='_blank' title='Anfahrt' href='https://www.google.de/maps/dir//Kapit%C3%A4n-Alexander-Stra%C3%9Fe+40,+27472+Cuxhaven/@53.8668035,8.7066221,17z/data=!4m13!1m4!3m3!1s0x47b4040e075eaf1f:0xfaba82b12994a2e!2sKapit%C3%A4n-Alexander-Stra%C3%9Fe+40,+27472+Cuxhaven!3b1!4m7!1m0!1m5!1m1!1s0x47b4040e075eaf1f:0xfaba82b12994a2e!2m2!1d8.7066221!2d53.8668035?hl=de'>\"+\n              \"Nautischer Verein Cuxhaven e.V.<br>Kapti&auml;n-Alexander-Str. 40<br>27472 Cuxhaven\"+\n            \"</a>\",\n          options: {\n            noHide: true\n          }\n        }\n      }\n    }\n  });\n\n  // called on content changes\n  $sailsSocket.subscribe('content', function(msg){\n    $log.debug(msg);\n    switch(msg.verb) {\n      case 'updated':\n        switch(msg.id) {\n          case 'imprint':\n            $scope.imprint = msg.data;\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Impressums-Text wurde aktualisiert', \"\");\n            }\n          break;\n        }\n      break;\n    }\n  });\n\n});\n","jumplink.cms.controller('LayoutController', function($rootScope, authenticated) {\n  $rootScope.authenticated = authenticated;\n});","jumplink.cms.controller('LinksController', function($rootScope, $scope, $sailsSocket, links, $location, $anchorScroll, $state, $log) {\n  var page = $state.current.name;\n  $scope.links = links;\n  $log.debug($scope.links);\n\n  $scope.goTo = function (hash) {\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n  $scope.toogleHtml = function() {\n    $scope.html = !$scope.html;\n  };\n\n  $scope.save = function() {\n    $scope.links.page = page;\n    $scope.links.name = 'links';\n    ContentService.saveOne($scope.links, page, function(err, links) {\n      if(err) {\n        $log.error(\"Error: On save content!\", err);\n        if(angular.isDefined(cb)) return cb(err); else return err;\n      } else {\n        $rootScope.pop('success', 'Content wurde aktualisiert', \"\");\n      }\n    });\n  };\n\n  // called on content changes\n  $sailsSocket.subscribe('content', function(msg) {\n    $log.debug(msg);\n    switch(msg.verb) {\n      case 'updated':\n        switch(msg.id) {\n          case 'links':\n            $scope.links = msg.data;\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Links-Text wurde aktualisiert', \"\");\n            }\n          break;\n        }\n      break;\n    }\n  });\n\n});","jumplink.cms.controller('MembersController', function($rootScope, authenticated, $scope, members, $sailsSocket, $filter, $modal, FileUploader, $log) {\n  $rootScope.authenticated = authenticated;\n  $scope.uploader = new FileUploader({url: 'member/upload', removeAfterUpload: true});\n  $scope.uploader.filters.push({\n    name: 'imageFilter',\n    fn: function(item /*{File|FileLikeObject}*/, options) {\n      var type = '|' + item.type.slice(item.type.lastIndexOf('/') + 1) + '|';\n      return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;\n    }\n  });\n  var editMemberModal = $modal({scope: $scope, title: 'Person bearbeiten', uploader: $scope.uploader, templateUrl: '/views/modern/members/editmodal.jade', show: false});\n\n  $scope.upload = function(fileItem, member) {\n    fileItem.member = member;\n    fileItem.upload();\n  };\n\n  $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n    fileItem.member.image = response.files[0].thumb;\n  };\n\n\n  var removeFromClient = function (member) {\n    var index = $scope.members.indexOf(member);\n    if (index > -1) {\n      $scope.members.splice(index, 1);\n    }\n  };\n\n  $scope.abort = function(hide) {\n    hide();\n  };\n\n  $scope.members = members;\n  $scope.remove = function(member, hide) {\n    if($rootScope.authenticated) {\n      if($scope.members.length > 2) {\n        if(member.id) {\n          $log.debug(member);\n          $sailsSocket.delete('/member/'+member.id).success(function(users, status, headers, config) {\n            removeFromClient(member);\n          });\n        } else {\n          removeFromClient(member);\n        }\n      }\n    }\n    hide();\n  };\n\n  $scope.add = function() {\n    if($rootScope.authenticated) {\n      if(!angular.isArray($scope.members)) $scope.members = [];\n      // var newMember = angular.copy($scope.members[$scope.members.length - 1]);\n      var newMember = {\n        position: $scope.members.length || 0,\n        name: \"\",\n        job: \"\",\n        image: \"photo.png\",\n        site: $scope.members[$scope.members.length - 1].site\n      };\n      // delete newMember.id;\n      // delete newMember.position++;\n      $scope.members.push(newMember);\n      $scope.edit(newMember);\n    }\n  };\n\n  var saveMember = function (member, cb) {\n    if(angular.isUndefined(member.id)) {\n      // create member\n      $sailsSocket.post('/member', member).success(function(data, status, headers, config) {\n        if(angular.isArray(data)) data = data[0];\n        $log.debug(data);\n        if(cb) cb(null, data);\n      });\n    } else {\n      // update member\n      $sailsSocket.put('/member/'+member.id, member).success(function(data, status, headers, config) {\n        if(angular.isArray(data)) data = data[0];\n        $log.debug(data);\n        if(cb) cb(null, data);\n      });\n    }\n  };\n\n  $scope.save = function(member, hide) {\n    if($rootScope.authenticated) {\n      if(angular.isUndefined(member)) {  // save all members\n        angular.forEach($scope.members, function(member, index) {\n          saveMember(member, function (err, result) {\n            if(err) {\n              $rootScope.pop('error', member.name, \"Konnte Mitglied nicht speichern.\", member.name);\n            } else {\n              $rootScope.pop('success', \"Mitglied erfolgreich auf dem Server gespeichert.\", member.name);\n            }\n          });\n        });\n      } else { // save just this member\n        saveMember(member, function (err, result) {\n          if(err) {\n            $rootScope.pop('error', member.name, \"Konnte Mitglied nicht speichern.\", member.name);\n          } else {\n            $rootScope.pop('success', \"Mitglied erfolgreich auf dem Server gespeichert.\", member.name);\n          }\n        });\n      }\n    }\n    hide();\n  };\n\n  $scope.edit = function(member) {\n    if($rootScope.authenticated) {\n      editMemberModal.$scope.member = member;\n      //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n      editMemberModal.$promise.then(editMemberModal.show);\n    }\n  };\n\n  $scope.moveForward = function(member) {\n    if($rootScope.authenticated) {\n      var index = $scope.members.indexOf(member);\n      if(index < $scope.members.length && angular.isDefined($scope.members[index+1])) {\n        var newPosition = $scope.members[index+1].position;\n        var oldPosition = $scope.members[index].position;\n        $log.debug(newPosition+\" <-> \"+oldPosition);\n        $scope.members[index].position = newPosition;\n        $scope.members[index+1].position = oldPosition;\n        $scope.members = $filter('orderBy')($scope.members, 'position');\n      } else {\n        $rootScope.pop('error', member.name, \"Kann nicht verschoben werden.\");\n      }\n    }\n  };\n\n  $scope.moveBackward = function(member) {\n    if($rootScope.authenticated) {\n      var index = $scope.members.indexOf(member);\n      if(index > 0 && angular.isDefined($scope.members[index-1])) {\n        var newPosition = $scope.members[index-1].position;\n        var oldPosition = $scope.members[index].position;\n        $log.debug(newPosition+\" <-> \"+oldPosition);\n        $scope.members[index].position = newPosition;\n        $scope.members[index-1].position = oldPosition;\n        $scope.members = $filter('orderBy')($scope.members, 'position');\n      } else {\n        $rootScope.pop('error', member.name, \"Kann nicht verschoben werden.\");\n      }\n    }\n  };\n\n  $sailsSocket.subscribe('member', function(msg){\n    $log.debug(msg);\n\n    switch(msg.verb) {\n      case 'updated':\n        if($rootScope.authenticated)\n          $rootScope.pop('success', 'Eine Person wurde aktualisiert', msg.data.name);\n      break;\n      case 'created':\n        if($rootScope.authenticated)\n          $rootScope.pop('success', 'Eine Person wurde erstellt', msg.data.name);\n      break;\n      case 'removedFrom':\n        if($rootScope.authenticated)\n          $rootScope.pop('success', 'Eine Person wurde entfernt', msg.id);\n      break;\n      case 'destroyed':\n        if($rootScope.authenticated)\n          $rootScope.pop('success', 'Eine Person wurde gelöscht', msg.id);\n      break;\n      case 'addedTo':\n        if($rootScope.authenticated)\n          $rootScope.pop('success', 'Eine Person wurde hinzugefügt', msg.data.name);\n      break;\n    }\n  });\n\n});","jumplink.cms.controller('SigninController', function($rootScope, $scope, $log, $stateParams, SigninService, authenticated, $state, HistoryService) {\n  $scope.error = $stateParams.error;\n  $rootScope.authenticated = authenticated;\n\n  $scope.signin = function () {\n    $log.debug($scope.user);\n    // $scope.user.role = 'superadmin';\n    SigninService.signin($scope.user, true, true, $rootScope, function (error, result) {\n      if(error) {\n        $scope.error = error;\n        return $scope.error ;\n      }\n      $rootScope.authenticated = result.authenticated;\n      $rootScope.user = result.user;\n      $rootScope.site = result.site;\n      $log.debug(\"[SigninController.signin]\", result);\n    });\n  };\n});","jumplink.cms.controller('TimelineController', function($rootScope, $scope, authenticated, events, config, EventService, $state, HistoryService, $log, $window) {\n  var page = $state.current.name;\n  $rootScope.authenticated = authenticated;\n  $scope.events = events; // TODO rename to eventBlocks\n  $scope.config = config;\n  $scope.goTo = HistoryService.goToHashPosition;\n  $scope.chooseType = EventService.chooseType;\n  var modals = EventService.setModals($scope, {}, page);\n  EventService.subscribe(); // TODO not working anymore\n\n  $scope.openAttachment = function (path) {\n    $window.open(path, '_blank');\n  };\n\n  $scope.save = function(event, eventBlockName) {\n    var errors = [\n      \"TimelineController: Can't save event.\",\n      \"TimelineController: Can't save eventBlocks.\"\n    ];\n    var sussces = [\n      'Ereignis wurde auf dem Server gespeichert.',\n      'Timeline wurde auf dem Server gespeichert.'\n    ];\n    if($rootScope.authenticated) {\n      // save just this event if defined\n      if(angular.isDefined(event) && angular.isDefined(eventBlockName)) {\n        EventService.saveOne($scope.events, eventBlockName, event, function (err, savedEvent) {\n          if(err) $log.error(errors[0], err);\n          else {\n            event = savedEvent;\n            $log.debug(sussces[0], event);\n            $rootScope.pop('success', sussces[0], event.title);\n          }\n        });\n      } else { // save all eventBlocks\n        EventService.saveBlocks($scope.events, function (err, savedEvents) {\n          if(err) $log.error(errors[1], err);\n          else {\n            $scope.events = savedEvents;\n            $log.debug(sussces[1], events);\n            $rootScope.pop('success', sussces[1], '');\n          }\n        });\n      }\n\n    }\n  };\n\n  $scope.add = function() {\n    var errors = [\n      \"Error: Konnte Ereignis nicht erzeugen\",\n      \"Error: Konnte Ereignis nicht hinzufügen\",\n    ];\n\n    var successes = [\n      \"Neues Ereignis erfolgreich hinzugefügt\",\n    ];\n\n    if($rootScope.authenticated) {\n      EventService.createEdit($scope.events, {page:page}, function(err, event) {\n        if(err) {\n          $log.error(errors[0], err);\n          $rootScope.pop('error', errors[0], err);\n          $scope.$apply();\n        } else {\n          $log.debug(\"start append\");\n          EventService.append($scope.events, event, function (err, events) {\n            if(err) {\n              $log.error(errors[1], err);\n              $rootScope.pop('error', errors[1], err);\n              $scope.$apply();\n            } else {\n              $scope.events = events;\n              $rootScope.pop('success', successes[0], event.title);\n              $scope.$apply();\n            }\n          });  \n        }\n      });\n    }\n  };\n\n  // TODO use async \"not found\"-callback is fired after value was found\n  var findEvent = function(id, callback) {\n    $log.debug(\"findEvent\", id);\n    angular.forEach(['after', 'before', 'unknown'], function(eventPart, index) {\n      if(eventPart === 'unknown' && $scope.events[eventPart].length <= 0) {\n        return callback(\"not found\");\n      }\n      angular.forEach($scope.events[eventPart], function(event, index) {\n        $log.debug(\"event.id\", event.id);\n        if(event.id == id) {\n          return callback(null, event, eventPart, index);\n        }\n        if(eventPart === 'unknown' && index === $scope.events[eventPart].length - 1 &&  event.id != id) {\n          return callback(\"not found\");\n        }\n      });\n    });\n  };\n\n  $scope.remove = function(event, eventBlockName) {\n    if($rootScope.authenticated) {\n      EventService.remove($scope.events, event, eventBlockName, function (err, events) {\n        if(err) {\n          $log.error(err);\n          $rootScope.pop('error', \"Ereignis konnte nicht entfernt werden.\", event.name);\n        } else {\n          $rootScope.pop('success', 'Ereignis erfolgreich entfernt', '');\n        }\n      });\n    }\n  };\n\n  $scope.refresh = function() {\n    $scope.events = EventService.refresh($scope.events);\n  };\n\n  $scope.edit = function(event, eventBlockName) {\n    if($rootScope.authenticated) {\n      EventService.edit(event, eventBlockName, function(err, event) {\n        if(err) {\n          if(err === 'discarded') {\n            $log.debug(\"Edit event \", err);\n            return 'discarded';\n          }\n          $log.error(\"Error: On edit event!\", err);\n          return err;\n        }\n        $scope.save(event, eventBlockName);\n      });\n    }\n  };\n\n  $scope.openTypeChooserModal = function(event) {\n    if($rootScope.authenticated) {\n      EventService.openTypeChooserModal(event);\n    }\n  };\n\n});","jumplink.cms.controller('ToolbarController', function($scope,  $log, routes) {\n  $scope.routes = routes;\n  $scope.title = \"JumpLink CMS Administration\";\n  $scope.shorttitle = \"Admin\";\n  $scope.position = \"fixed-top\";\n  $scope.fluid = false;\n  $scope.filter = {navbar: 'header'};\n});","jumplink.cms.controller('UserController', function($scope, user, $state, $log, UserService) {\n  $scope.user = user;\n\n  $scope.save = function (user) {\n\n    if(angular.isUndefined(user))\n      user = $scope.user;\n\n    UserService.save(user, function (err, user) {\n\n      $state.go('layout.users');\n    });\n  };\n\n  UserService.subscribe();\n});","jumplink.cms.controller('UsersController', function($scope, $rootScope, $sailsSocket, users, $log, UserService) {\n  $scope.users = users;\n\n  $scope.remove = function(user) {\n    UserService.remove($scope.users, user);\n  };\n\n  UserService.subscribe();\n\n});","// source: https://github.com/TheSharpieOne/angular-input-match\njumplink.cms.directive('match', function () {\n  return {\n    require: 'ngModel',\n    restrict: 'A',\n    scope: {\n      match: '='\n    },\n    link: function(scope, elem, attrs, ctrl) {\n      scope.$watch(function() {\n        var modelValue = ctrl.$modelValue || ctrl.$$invalidModelValue;\n        return (ctrl.$pristine && angular.isUndefined(modelValue)) || scope.match === modelValue;\n      }, function(currentValue) {\n        ctrl.$setValidity('match', currentValue);\n      });\n    }\n  };\n});\n","// Angular File Upload module does not include this directive\n// Only for example\n\n\n/**\n* The ng-thumb directive\n* @author: nerv\n* @version: 0.1.2, 2014-01-09\n*/\njumplink.cms.directive('ngThumb', function($window) {\n\n  var helper = {\n    support: !!($window.FileReader && $window.CanvasRenderingContext2D),\n    isFile: function(item) {\n      return angular.isObject(item) && item instanceof $window.File;\n    },\n    isImage: function(file) {\n      var type =  '|' + file.type.slice(file.type.lastIndexOf('/') + 1) + '|';\n      return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;\n    }\n  };\n\n  return {\n    restrict: 'A',\n    template: '<canvas/>',\n    link: function(scope, element, attributes) {\n      if (!helper.support) return;\n\n      var params = scope.$eval(attributes.ngThumb);\n\n      if (!helper.isFile(params.file)) {\n        console.log(\"param file is no file\");\n        return;\n      }\n      if (!helper.isImage(params.file)) {\n        console.log(\"param file is no image\");\n        return;\n      }\n\n      console.log(\"params.file\", params.file);\n\n      var canvas = element.find('canvas');\n      var reader = new FileReader();\n\n      reader.onload = onLoadFile;\n      reader.readAsDataURL(params.file);\n\n      function onLoadFile(event) {\n        var img = new Image();\n        img.onload = onLoadImage;\n        img.src = event.target.result;\n      }\n\n      function onLoadImage() {\n        var width = params.width || this.width / this.height * params.height;\n        var height = params.height || this.height / this.width * params.width;\n        canvas.attr({ width: width, height: height });\n        canvas[0].getContext('2d').drawImage(this, 0, 0, width, height);\n      }\n    }\n  };\n});\n","// http://stackoverflow.com/questions/14703517/angular-js-set-element-height-on-page-load\njumplink.cms.directive('resize', function ($rootScope, $window, $timeout) {\n  return function (scope, element) {\n\n    var setStyle = function (newValue) {\n      scope.style = function (style) {\n        if(typeof style === 'undefined') {\n          style = {};\n        }\n        style.height = (newValue.h) + 'px';\n        style.width = (newValue.w) + 'px';\n        return style;\n      };\n    };\n\n    // $rootScope.getWindowDimensions is defined in bootstrap/controllers.js !\n    scope.$watch($rootScope.getWindowDimensions, function (newValue, oldValue) {\n      setStyle(newValue);\n      $timeout(function(){\n        scope.$apply();\n      });\n    }, true);\n  };\n});\n","angular.module('webodf', [])\n  .directive('webodfview', function ($compile, $window, $sailsSocket, $async) {\n\n    var createBlob = function (type, data, callback) {\n      if (window.File && window.FileReader && window.FileList && window.Blob) {\n        var blob = new Blob([data.buffer], {type : 'application/vnd.oasis.opendocument.'+type});\n        callback(null, blob);\n      } else {\n        callback('The File APIs are not fully supported in this browser.');\n      }\n    };\n\n    /*\n     * Download Blob to locale client pc direct from thewebodf  browser's odt file\n     */\n    var downloadBlob = function(type, data, callback) {\n      var url;\n      createBlob(type, data, function(error, blob) {\n        if(error) {\n          callback(error);\n        } else {\n          url = (window.webkitURL || window.URL).createObjectURL(blob);\n          location.href = url; // <-- Download!\n        }\n      });\n    };\n\n    /*\n     * Like downloadBlob but with filename\n     */\n    var downloadBlobAs = function(filename, type, data, callback) {\n      var url;\n      createBlob(type, data, function(error, blob) {\n        if(error) {\n          callback(error);\n        } else {\n          window.saveAs(blob, filename);\n          callback(null);\n        }\n      });\n    };\n\n    /*\n     * Request to server with file stream of the document.\n     */\n    var uploadBlobAs = function(folder, filename, type, data, callback) {\n      var formData, req, path, resInfo;\n      createBlob(type, data, function(error, blob) {\n        if(error) {\n          callback(error);\n        } else {\n          formData = new FormData();\n          formData.append(\"documents\", blob, filename);\n          req = new XMLHttpRequest();\n          path = folder+\"/\"+filename;\n          req.open(\"PUT\", path);\n          req.send(formData);\n          req.onload = function(res) {\n            resInfo = JSON.parse(req.responseText);\n            callback(null, resInfo);\n          };\n        }\n      });\n    };\n\n    /*\n     * Download document to the client without filename.\n     */\n    var download = function(odfContainer, callback) {\n      odfContainer.createByteArray(function(data) {\n        downloadBlob(odfContainer.getDocumentType(), data, callback);\n      });\n    };\n\n    /*\n     * Download document to the client with filename.\n     */\n    var downloadAs = function(odfContainer, filename, callback) {\n      odfContainer.createByteArray(function(data) {\n        downloadBlobAs(filename, odfContainer.getDocumentType(), data, callback);\n      });\n    };\n\n    /*\n     * Upload document to the server.\n     */\n    var uploadAs = function(odfContainer, folder, filename, callback) {\n      odfContainer.createByteArray(function(data) {\n        uploadBlobAs(folder, filename, odfContainer.getDocumentType(), data, callback);\n      });\n    };\n\n    /*\n     * Get all custom user field variables and inputs.\n     * return: Object {get: array of custom user field variables, decl: array of custom user field inputs}\n     */\n    var getUserFieldElements = function (odfParentNodeElement, callback) {\n      var textns = \"urn:oasis:names:tc:opendocument:xmlns:text:1.0\";\n      var userFieldsGet = odfParentNodeElement.getElementsByTagNameNS(textns, 'user-field-get');\n      var userFieldsDecl = odfParentNodeElement.getElementsByTagNameNS(textns, 'user-field-decls')[0].childNodes;\n      if(angular.isFunction(callback)) {\n        callback(null, {get: userFieldsGet, decl: userFieldsDecl});\n      }\n      return {get: userFieldsGet, decl: userFieldsDecl};\n    };\n\n    /*\n     * Create new custom user field variable.\n     * return: the new new custom user field variable element.\n     */\n    var newUserFieldDeclElement = function (odfContentNodeElement, name, value, type) {\n      //TODO just if not exists\n      var textns = \"urn:oasis:names:tc:opendocument:xmlns:text:1.0\";\n      var userFieldsDecls = odfContentNodeElement.getElementsByTagNameNS(textns, 'user-field-decls')[0];\n      var newElement = document.createElementNS(textns, 'text:user-field-decl');\n      newElement.setAttribute('office:value-type', type); // float\n      switch(type) {\n        case 'float':\n          newElement.setAttribute('office:value', value);\n        break;\n        case 'string':\n          ewElement.setAttribute('office:'+type+'-value', value);\n        break;\n        case 'time':\n          ewElement.setAttribute('office:'+type+'-value', value);\n        break;\n        default: // TODO test more types\n          newElement.setAttribute('office:'+type+'-value', value);\n        break;\n      }\n      newElement.setAttribute('text:name', name);\n      userFieldsDecls.appendChild(newElement);\n      return newElement;\n    };\n\n    /*\n     * Redefine custom user field inputs (custom user field get elements).\n     * This function updates and renames the custom user field inputs found in userFieldGetNodeElements\n     */\n    var redefineUserFieldGetElement = function (userFieldGetNodeElements, name, newname, value, callback) {\n      var renamed = 0;\n      for (var i = 0; i < userFieldGetNodeElements.length; i++) {\n        var element = userFieldGetNodeElements[i];\n        var currentName = element.getAttribute('text:name');\n        if(currentName === name) {\n          element.textContent = value;\n          element.setAttribute('text:name', newname);\n          renamed++;\n        }\n      }\n      if(angular.isFunction(callback)) {\n        callback(renamed, userFieldGetNodeElements);\n      } \n      return renamed;\n    };\n\n    /*\n     * Update custom user field inputs (custom user field get elements).\n     * This function updates the inputs that are equal to \"name\" in \"userFieldGetNodeElements\" with \"value\".\n     */\n    var updateUserFieldGetElement = function (userFieldGetNodeElements, name, value, callback) {\n      var founds = 0;\n      for (var i = 0; i < userFieldGetNodeElements.length; i++) {\n        var element = userFieldGetNodeElements[i];\n        var currentName = element.getAttribute('text:name');\n        if(currentName === name) {\n          element.textContent = value;\n          founds++;\n        }\n      }\n      if(angular.isFunction(callback)) {\n        callback(founds, userFieldGetNodeElements);\n      }\n      return founds;\n    };\n\n    /*\n     * Update custom user field variables (custom user field decl elements).\n     * This function updates the variables that are equal to \"name\" in \"userFieldDeclNodeElements\" with \"value\".\n     * If the variable is not defined/found the function returns an error or call the calback with an error.\n     */\n    var updateUserFieldDeclElement = function (userFieldDeclNodeElements, name, value, callback) {\n      var error, notFound = true;\n      for (var i = 0; i < userFieldDeclNodeElements.length; i++) {\n        var element = userFieldDeclNodeElements[i];\n        var currentName = element.getAttribute('text:name');\n        var type = element.getAttribute('office:value-type');\n        if(currentName === name) {\n          notFound = false;\n          switch(type) {\n            case 'float':\n              element.setAttribute('office:value', value);\n            break;\n            case 'string':\n              element.setAttribute('office:'+type+'-value', value);\n            break;\n            case 'time':\n              element.setAttribute('office:'+type+'-value', value);\n            break;\n            default: // TODO test more types\n              element.setAttribute('office:'+type+'-value', value);\n            break;\n          }\n        }\n      }\n      if(notFound) {\n        error = name+\" not found\";\n      }\n      if(callback) {\n        callback(error, userFieldDeclNodeElements);\n      }\n      return error;\n    };\n\n    /*\n     * Update custom user field variables (custom user field decl elements) and inputs (custom user field get elements).\n     * This function updates the variable and inputs found in userFieldNodeElements, but only if the UserFieldDeclElement is found / variable is set.\n     */\n    var updateUserFieldElement = function (userFieldNodeElements, name, value, callback) {\n      var error, curValue;\n      if(typeof value !== 'undefined' && value !== null) {\n        if(typeof value.human !== 'undefined') {\n          curValue = value.human;\n        } else {\n          curValue = value;\n        }\n        updateUserFieldDeclElement(userFieldNodeElements.decl, name, curValue, function(error, userFieldDeclNodeElements){\n          if(error) {\n            if(callback) { callback(error); }\n            return error;\n          }\n          updateUserFieldGetElement(userFieldNodeElements.get, name, curValue, function(founds, userFieldGetNodeElements) {\n            callback(null, {get: userFieldGetNodeElements, decl: userFieldDeclNodeElements});\n          });\n        });\n      } else {\n        error = \"value not set: \"+name;\n        callback(error);\n      }\n    };\n\n    var initializeWidth = function(odfCanvas, element) {\n      var paddingLeft = 0, paddingRight = 0, clientWidth = 0, innerWidth = 0;\n      if(window) {\n        paddingLeft = parseInt(window.getComputedStyle(element.parent()[0], null).getPropertyValue('padding-left'));\n        paddingRight = parseInt(window.getComputedStyle(element.parent()[0], null).getPropertyValue('padding-right'));\n      }\n      clientWidth = element.parent()[0].clientWidth;\n      innerWidth = clientWidth - paddingLeft - paddingRight;\n      odfCanvas.fitSmart(innerWidth); // set width to 100% of parent element\n    };\n\n    var updateDocument = function(odfContentNodeElement, data, callback) {\n      var userFieldNodeElements = getUserFieldElements(odfContentNodeElement);\n      if(data) {\n        $async.objectMap(data, function(data, callback) {\n          var key = Object.keys(data)[0];\n          switch(key) {\n            case 'bank':\n              $async.objectMap(data.bank, function(data, callback) {\n                var subkey = Object.keys(data)[0];\n                updateUserFieldElement(userFieldNodeElements, key+'.'+subkey, data[subkey], function(error) {\n                  callback(error, data);\n                });\n              }, callback);\n            break;\n            default:\n              // WORKAROUND\n              // if(typeof data[key]._isAMomentObject != 'undefined' && data[key]._isAMomentObject)\n              //   data[key] = data[key].format('L');\n              updateUserFieldElement(userFieldNodeElements, key, data[key], function(error) {\n                callback(error, data);\n              });\n            break;\n          }\n        }, callback);\n      }\n    };\n\n    var removeAllChilds = function (element) {\n      while (element.firstChild) {\n          element.removeChild(element.firstChild);\n      }\n    };\n\n\n    return {\n      restrict: 'E',\n      scope: {file : \"@\", invoice: \"=\", upload: \"=\", refresh: \"=\", ready: \"=\", download: \"=\"},\n      link: function ($scope, $element, $attrs) {\n        var nid, odfCanvas, templateServiceTableElement, templateExpenditureTableElement, odfContentNodeElement, odfContainer;\n\n        nid = 'odt' + Math.floor((Math.random()*100)+1);\n        $element.attr('id', nid);\n        odfCanvas = new odf.OdfCanvas($element[0]);\n        odfCanvas.load($scope.file);\n\n        $scope.upload = function (callback) {\n          uploadAs(odfContainer, \"/document/upload\", \"new.odt\", callback);\n        };\n\n        $scope.download = function (name) {\n          downloadAs(odfContainer, name, function(error) {\n            if(error) { console.log(error); }\n          });\n        };\n\n        $scope.refresh = function (callback) {\n          updateDocument(odfContentNodeElement, $scope.invoice, callback);\n        };\n\n        angular.element($window).bind('resize', function() {\n          initializeWidth(odfCanvas, $element);\n          // $scope.$apply();\n        });\n\n        // Callback fired after odf document is ready\n        odfCanvas.addListener(\"statereadychange\", function () {\n\n          odfCanvas.refreshSize();\n          initializeWidth(odfCanvas, $element);\n\n          odfContainer = odfCanvas.odfContainer();\n          odfContentNodeElement = odfContainer.getContentElement();\n\n          $scope.ready();\n\n        });\n\n      }\n    };\n  });\n"],"sourceRoot":"/source/"}